<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Ø¥Ø¯Ø§Ø±Ø© Ø¹Ù…Ù„ÙŠØ§Øª Ø§Ù„Ø³Ø§Ø­Ø§Øª Ø§Ù„Ø®Ø§Ø±Ø¬ÙŠØ© ÙˆØ§Ù„Ù…ÙˆØ§ØµÙ„Ø§Øª</title>
    <style>
        :root {
            --primary: #ffd700;
            --bg-dark: #0a0a0a;
            --bg-card: #1a1a1a;
            --bg-input: #2a2a2a;
            --green: #4caf50;
            --blue: #2196f3;
            --red: #f44336;
            --orange: #ff9800;
            --purple: #9c27b0;
            --cyan: #00bcd4;
            --text: #fff;
            --text-muted: #888;
            --panel-width: 340px;
        }

        * { margin: 0; padding: 0; box-sizing: border-box; }
        html, body { height: 100%; overflow: hidden; }
        body {
            font-family: 'Segoe UI', Tahoma, Arial, sans-serif;
            background: var(--bg-dark);
            color: var(--text);
            display: flex;
            flex-direction: column;
        }

        ::-webkit-scrollbar { width: 6px; height: 6px; }
        ::-webkit-scrollbar-track { background: var(--bg-dark); }
        ::-webkit-scrollbar-thumb { background: var(--primary); border-radius: 3px; }

        /* â•â•â•â•â•â•â•â•â•â•â•â•â•â• NOTIFICATIONS â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
        .notifications-container {
            position: fixed;
            top: 60px;
            left: 20px;
            z-index: 3000;
            display: flex;
            flex-direction: column;
            gap: 10px;
            max-width: 380px;
        }
        .notification {
            padding: 14px 18px;
            border-radius: 10px;
            display: flex;
            align-items: center;
            gap: 12px;
            animation: slideIn 0.4s ease;
            box-shadow: 0 8px 30px rgba(0,0,0,0.6);
            cursor: pointer;
            backdrop-filter: blur(10px);
        }
        .notification.success { background: linear-gradient(135deg, rgba(27,94,32,0.95), rgba(46,125,50,0.95)); border-left: 5px solid var(--green); }
        .notification.error { background: linear-gradient(135deg, rgba(183,28,28,0.95), rgba(198,40,40,0.95)); border-left: 5px solid var(--red); }
        .notification.warning { background: linear-gradient(135deg, rgba(230,81,0,0.95), rgba(245,124,0,0.95)); border-left: 5px solid var(--orange); }
        .notification.info { background: linear-gradient(135deg, rgba(13,71,161,0.95), rgba(21,101,192,0.95)); border-left: 5px solid var(--blue); }
        .notification-icon { font-size: 24px; }
        .notification-content { flex: 1; }
        .notification-title { font-weight: 700; font-size: 13px; }
        .notification-message { font-size: 11px; opacity: 0.9; margin-top: 3px; }
        .notification-close { background: none; border: none; color: #fff; font-size: 18px; cursor: pointer; opacity: 0.7; }
        .notification-close:hover { opacity: 1; }
        @keyframes slideIn { from { transform: translateX(-120%); opacity: 0; } to { transform: translateX(0); opacity: 1; } }

        /* â•â•â•â•â•â•â•â•â•â•â•â•â•â• TOGGLE PANEL â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
        .toggle-panel {
            position: fixed;
            top: 50%;
            right: 0;
            transform: translateY(-50%);
            background: var(--primary);
            color: #000;
            padding: 15px 8px;
            cursor: pointer;
            z-index: 1001;
            border-radius: 8px 0 0 8px;
            font-weight: 700;
            writing-mode: vertical-rl;
            transition: all 0.3s;
            font-size: 12px;
        }
        .toggle-panel:hover { padding-right: 15px; background: #fff; }
        .toggle-panel.panel-visible { right: var(--panel-width); }

        /* â•â•â•â•â•â•â•â•â•â•â•â•â•â• CONTROL PANEL â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
        .control-panel {
            position: fixed;
            top: 0;
            right: 0;
            width: var(--panel-width);
            height: 100vh;
            background: linear-gradient(180deg, #1a1a1a 0%, #0d0d0d 100%);
            border-left: 3px solid var(--primary);
            z-index: 1000;
            transition: transform 0.3s;
            display: flex;
            flex-direction: column;
        }
        .control-panel.hidden { transform: translateX(100%); }

        .panel-tabs {
            display: flex;
            flex-wrap: wrap;
            gap: 2px;
            padding: 8px;
            flex-shrink: 0;
            background: var(--bg-dark);
            border-bottom: 1px solid var(--primary);
        }
        .panel-tab {
            flex: 1 1 auto;
            min-width: 45px;
            padding: 6px 3px;
            background: var(--bg-input);
            border: 1px solid var(--primary);
            color: var(--text-muted);
            border-radius: 5px 5px 0 0;
            cursor: pointer;
            font-size: 9px;
            text-align: center;
            transition: all 0.3s;
            position: relative;
        }
        .panel-tab.active { background: var(--primary); color: #000; font-weight: 700; }
        .panel-tab .badge {
            position: absolute;
            top: -5px;
            left: -5px;
            background: var(--red);
            color: #fff;
            font-size: 8px;
            padding: 2px 5px;
            border-radius: 10px;
            min-width: 16px;
        }

        .panel-content { flex: 1; overflow-y: auto; overflow-x: hidden; padding: 8px; }
        .tab-content { display: none; }
        .tab-content.active { display: block; }

        .control-section {
            background: rgba(255,215,0,0.03);
            border: 1px solid rgba(255,215,0,0.3);
            border-radius: 6px;
            padding: 10px;
            margin-bottom: 10px;
        }
        .control-title {
            font-size: 12px;
            font-weight: 700;
            color: var(--primary);
            margin-bottom: 8px;
            padding-bottom: 5px;
            border-bottom: 1px solid rgba(255,215,0,0.3);
        }
        .control-group { margin-bottom: 8px; }
        .control-label { display: block; font-size: 10px; color: var(--text-muted); margin-bottom: 3px; }
        .control-input, .control-select {
            width: 100%;
            padding: 6px 8px;
            background: var(--bg-input);
            border: 1px solid rgba(255,215,0,0.5);
            color: var(--text);
            border-radius: 4px;
            font-size: 11px;
        }
        .control-row { display: grid; grid-template-columns: 1fr 1fr; gap: 8px; }
        .control-button {
            width: 100%;
            padding: 8px;
            background: linear-gradient(135deg, var(--primary), #ffed4e);
            color: #000;
            border: none;
            border-radius: 5px;
            font-weight: 700;
            cursor: pointer;
            font-size: 11px;
            transition: all 0.3s;
            margin-top: 5px;
        }
        .control-button:hover { transform: translateY(-2px); box-shadow: 0 5px 15px rgba(255,215,0,0.4); }
        .control-button.danger { background: linear-gradient(135deg, var(--red), #e57373); color: #fff; }
        .control-button.success { background: linear-gradient(135deg, var(--green), #81c784); color: #fff; }
        .control-button.info { background: linear-gradient(135deg, var(--blue), #64b5f6); color: #fff; }

        /* â•â•â•â•â•â•â•â•â•â•â•â•â•â• FORM LIST â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
        .form-list-item {
            padding: 12px;
            background: var(--bg-input);
            border: 2px solid rgba(255,215,0,0.3);
            border-radius: 8px;
            margin-bottom: 8px;
            cursor: pointer;
            transition: all 0.3s;
        }
        .form-list-item:hover {
            background: rgba(255,215,0,0.1);
            border-color: var(--primary);
            transform: translateX(-5px);
        }
        .form-list-item .form-name { font-size: 12px; font-weight: 700; color: var(--primary); }
        .form-list-item .form-name-ar { font-size: 10px; color: var(--text-muted); margin-top: 2px; }

        /* â•â•â•â•â•â•â•â•â•â•â•â•â•â• BUS LIST â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
        .bus-list-item {
            padding: 10px;
            background: var(--bg-input);
            border: 2px solid rgba(255,215,0,0.3);
            border-radius: 8px;
            margin-bottom: 8px;
            cursor: pointer;
            transition: all 0.3s;
        }
        .bus-list-item:hover { background: rgba(255,215,0,0.1); border-color: var(--primary); }
        .bus-list-item.in-parking { border-color: var(--green); }
        .bus-list-item .bus-plate { font-size: 14px; font-weight: 700; color: var(--primary); }
        .bus-list-item .bus-flight { font-size: 11px; color: var(--cyan); }
        .bus-list-item .bus-details { font-size: 9px; color: var(--text-muted); margin-top: 4px; }
        .bus-list-item .progress-bar {
            display: flex;
            gap: 3px;
            margin-top: 8px;
        }
        .bus-list-item .progress-step {
            flex: 1;
            height: 4px;
            background: #333;
            border-radius: 2px;
        }
        .bus-list-item .progress-step.done { background: var(--green); }
        .bus-list-item .progress-step.current { background: var(--orange); }

        /* â•â•â•â•â•â•â•â•â•â•â•â•â•â• ALERTS LOG â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
        .alerts-container {
            max-height: 500px;
            overflow-y: auto;
            background: var(--bg-dark);
            border-radius: 5px;
        }
        .alert-item {
            padding: 10px 12px;
            margin-bottom: 6px;
            border-radius: 6px;
            font-size: 10px;
            border-right: 4px solid;
            background: var(--bg-input);
        }
        .alert-item.critical { border-color: var(--red); background: rgba(244,67,54,0.1); }
        .alert-item.warning { border-color: var(--orange); background: rgba(255,152,0,0.1); }
        .alert-item.info { border-color: var(--blue); background: rgba(33,150,243,0.1); }
        .alert-item.success { border-color: var(--green); background: rgba(76,175,80,0.1); }
        .alert-icon { font-size: 14px; margin-left: 8px; }
        .alert-message { font-size: 11px; line-height: 1.5; }
        .alert-time { font-size: 9px; color: var(--text-muted); margin-top: 4px; }

        /* â•â•â•â•â•â•â•â•â•â•â•â•â•â• HEADER â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
        .header {
            height: 50px;
            background: linear-gradient(180deg, #1a1a1a 0%, #0a0a0a 100%);
            padding: 0 20px;
            border-bottom: 3px solid var(--primary);
            display: flex;
            justify-content: space-between;
            align-items: center;
            flex-shrink: 0;
            transition: margin-right 0.3s;
        }
        .header.panel-open { margin-right: var(--panel-width); }
        .header-title { font-size: 16px; font-weight: 700; color: var(--primary); }
        .header-controls { display: flex; gap: 8px; }
        .header-btn {
            padding: 6px 12px;
            background: rgba(255,215,0,0.1);
            border: 2px solid var(--primary);
            color: var(--primary);
            border-radius: 5px;
            font-weight: 600;
            font-size: 11px;
            cursor: pointer;
        }
        .header-btn:hover { background: var(--primary); color: #000; }

        /* â•â•â•â•â•â•â•â•â•â•â•â•â•â• STATS â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
        .daily-stats {
            height: 40px;
            background: rgba(255,215,0,0.03);
            padding: 5px 20px;
            display: flex;
            justify-content: center;
            align-items: center;
            gap: 15px;
            border-bottom: 1px solid rgba(255,215,0,0.3);
            flex-shrink: 0;
            transition: margin-right 0.3s;
        }
        .daily-stats.panel-open { margin-right: var(--panel-width); }
        .daily-stat {
            display: flex;
            align-items: center;
            gap: 6px;
            padding: 4px 10px;
            background: var(--bg-card);
            border: 1px solid var(--primary);
            border-radius: 5px;
        }
        .daily-stat-value { font-size: 14px; font-weight: 700; color: var(--primary); }
        .daily-stat-label { font-size: 8px; color: var(--text-muted); }

        .stats-bar {
            height: 70px;
            background: var(--bg-card);
            padding: 8px 20px;
            display: flex;
            justify-content: center;
            align-items: center;
            gap: 15px;
            border-bottom: 2px solid var(--primary);
            flex-shrink: 0;
            transition: margin-right 0.3s;
        }
        .stats-bar.panel-open { margin-right: var(--panel-width); }
        .stat-card {
            background: rgba(255,215,0,0.05);
            border: 2px solid var(--primary);
            border-radius: 8px;
            padding: 6px 18px;
            text-align: center;
            cursor: pointer;
            min-width: 110px;
        }
        .stat-card.green { border-color: var(--green); }
        .stat-card.blue { border-color: var(--blue); }
        .stat-card.red { border-color: var(--red); animation: pulse-card 0.4s infinite; }
        @keyframes pulse-card {
            0%,100% { box-shadow: 0 0 10px var(--red); }
            50% { box-shadow: 0 0 30px var(--red), 0 0 60px var(--red); }
        }
        .stat-value { font-size: 24px; font-weight: 700; color: var(--primary); }
        .stat-card.green .stat-value { color: var(--green); }
        .stat-card.blue .stat-value { color: var(--blue); }
        .stat-card.red .stat-value { color: var(--red); }
        .stat-label { font-size: 9px; color: var(--text-muted); }

        /* â•â•â•â•â•â•â•â•â•â•â•â•â•â• MAIN CONTAINER â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
        .main-container {
            flex: 1;
            overflow: auto;
            transition: margin-right 0.3s;
            padding: 15px;
        }
        .main-container.panel-open { margin-right: var(--panel-width); }

        .parking-wrapper {
            display: flex;
            flex-wrap: wrap;
            gap: 8px;
            justify-content: center;
            align-content: flex-start;
        }

        .section-label {
            width: 100%;
            text-align: center;
            background: rgba(255,215,0,0.15);
            border: 2px solid var(--primary);
            padding: 8px 15px;
            border-radius: 6px;
            font-size: 14px;
            font-weight: 700;
            color: var(--primary);
            margin: 10px 0;
        }

        /* â•â•â•â•â•â•â•â•â•â•â•â•â•â• PARKING SPOTS â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
        .parking-spot {
            width: calc(10% - 8px);
            min-width: 80px;
            max-width: 120px;
            aspect-ratio: 3/4;
            background: var(--bg-input);
            border: 3px solid #333;
            border-radius: 8px;
            padding: 5px;
            position: relative;
            cursor: pointer;
            transition: all 0.3s;
            display: flex;
            flex-direction: column;
        }

        @media (max-width: 1400px) { .parking-spot { width: calc(11% - 8px); } }
        @media (max-width: 1200px) { .parking-spot { width: calc(12.5% - 8px); } }
        @media (max-width: 1000px) { .parking-spot { width: calc(14.28% - 8px); } }
        @media (max-width: 800px) { .parking-spot { width: calc(16.66% - 8px); min-width: 70px; } }

        .parking-spot:hover {
            transform: scale(1.08);
            box-shadow: 0 0 25px rgba(255,215,0,0.6);
            z-index: 10;
        }
        .parking-spot.early {
            background: linear-gradient(135deg, #1b5e20, #2e7d32);
            border-color: var(--green);
            box-shadow: 0 0 15px rgba(76,175,80,0.5);
        }
        .parking-spot.ontime {
            background: linear-gradient(135deg, #0d47a1, #1565c0);
            border-color: var(--blue);
            box-shadow: 0 0 15px rgba(33,150,243,0.5);
        }
        .parking-spot.late {
            background: linear-gradient(135deg, #b71c1c, #d32f2f);
            border-color: var(--red);
            animation: spot-pulse-intense 0.3s infinite;
        }
        @keyframes spot-pulse-intense {
            0%, 100% { 
                box-shadow: 0 0 20px var(--red), 0 0 40px var(--red);
                transform: scale(1);
            }
            50% { 
                box-shadow: 0 0 50px var(--red), 0 0 100px var(--red), 0 0 150px rgba(244,67,54,0.5);
                transform: scale(1.03);
                border-color: #fff;
            }
        }
        .parking-spot.empty {
            background: rgba(30,30,30,0.5);
            border-color: #333;
            opacity: 0.35;
        }
        .parking-spot.empty:hover { opacity: 0.7; }
        .parking-spot.selected {
            border: 4px solid #fff !important;
            box-shadow: 0 0 30px #fff !important;
            animation: none !important;
        }

        .spot-number {
            position: absolute;
            top: 3px;
            right: 3px;
            background: rgba(0,0,0,0.9);
            color: var(--primary);
            padding: 2px 5px;
            border-radius: 4px;
            font-size: 9px;
            font-weight: 700;
        }
        .spot-badge {
            position: absolute;
            top: 3px;
            left: 3px;
            padding: 2px 5px;
            border-radius: 4px;
            font-size: 7px;
            font-weight: 700;
        }
        .bus-info {
            flex: 1;
            display: flex;
            flex-direction: column;
            justify-content: center;
            gap: 2px;
            margin-top: 18px;
            font-size: 8px;
        }
        .info-line {
            display: flex;
            align-items: center;
            gap: 3px;
            white-space: nowrap;
            overflow: hidden;
            text-overflow: ellipsis;
        }
        .info-icon { font-size: 9px; }
        
        /* â•â•â•â•â•â•â•â•â•â•â•â•â•â• COUNTDOWN TIMER â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
        .countdown-timer {
            text-align: center;
            font-size: 10px;
            font-weight: 700;
            padding: 4px;
            background: rgba(0,0,0,0.6);
            border-radius: 4px;
            margin-top: auto;
        }
        .countdown-timer.urgent {
            background: rgba(244,67,54,0.8);
            animation: blink 0.5s infinite;
        }
        @keyframes blink {
            50% { opacity: 0.5; }
        }
        .countdown-timer .timer-label { font-size: 7px; color: var(--text-muted); }
        .countdown-timer .timer-value { font-size: 11px; }

        .empty-text {
            text-align: center;
            color: #444;
            font-size: 16px;
            margin-top: 30%;
        }

        /* â•â•â•â•â•â•â•â•â•â•â•â•â•â• MODAL â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
        .modal {
            display: none;
            position: fixed;
            top: 0; left: 0;
            width: 100%; height: 100%;
            background: rgba(0,0,0,0.9);
            z-index: 2000;
            justify-content: center;
            align-items: center;
            padding: 20px;
        }
        .modal.active { display: flex; }
        .modal-content {
            background: var(--bg-card);
            border: 3px solid var(--primary);
            border-radius: 12px;
            padding: 20px;
            max-width: 650px;
            width: 100%;
            max-height: 90vh;
            overflow-y: auto;
        }
        .modal-header {
            font-size: 16px;
            font-weight: 700;
            color: var(--primary);
            margin-bottom: 15px;
            padding-bottom: 10px;
            border-bottom: 2px solid var(--primary);
            display: flex;
            justify-content: space-between;
            align-items: center;
        }
        .modal-close {
            background: none;
            border: none;
            color: var(--text);
            font-size: 24px;
            cursor: pointer;
        }
        .form-group { margin-bottom: 12px; }
        .form-row { display: grid; grid-template-columns: 1fr 1fr; gap: 12px; }
        .form-row-3 { display: grid; grid-template-columns: 1fr 1fr 1fr; gap: 10px; }
        .form-label { display: block; font-size: 11px; color: var(--text-muted); margin-bottom: 4px; }
        .form-input, .form-select {
            width: 100%;
            padding: 10px;
            background: var(--bg-input);
            border: 2px solid #444;
            color: var(--text);
            border-radius: 6px;
            font-size: 13px;
        }
        .form-input:focus, .form-select:focus { outline: none; border-color: var(--primary); }
        .modal-buttons { display: flex; gap: 10px; margin-top: 20px; }
        .modal-btn {
            flex: 1;
            padding: 12px;
            border: none;
            border-radius: 6px;
            font-weight: 700;
            cursor: pointer;
            font-size: 14px;
        }
        .modal-btn.primary { background: linear-gradient(135deg, var(--primary), #ffed4e); color: #000; }
        .modal-btn.secondary { background: var(--bg-input); color: var(--text); border: 2px solid #444; }
        .modal-btn:hover { transform: translateY(-2px); }

        /* â•â•â•â•â•â•â•â•â•â•â•â•â•â• TOOLTIP â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
        .tooltip {
            position: fixed;
            background: rgba(0,0,0,0.95);
            border: 2px solid var(--primary);
            padding: 12px;
            border-radius: 8px;
            pointer-events: none;
            z-index: 1500;
            display: none;
            min-width: 220px;
            box-shadow: 0 10px 40px rgba(255,215,0,0.3);
        }
        .tooltip-title { font-size: 13px; font-weight: 700; color: var(--primary); margin-bottom: 8px; border-bottom: 1px solid var(--primary); padding-bottom: 5px; }
        .tooltip-line { font-size: 11px; margin: 4px 0; }

        .fullscreen-btn {
            position: fixed;
            bottom: 15px;
            left: 15px;
            background: var(--primary);
            color: #000;
            border: none;
            padding: 10px 15px;
            border-radius: 8px;
            cursor: pointer;
            font-weight: 700;
            z-index: 999;
        }

        .zoom-btns { display: flex; gap: 5px; }
        .zoom-btn {
            flex: 1;
            padding: 8px;
            background: var(--bg-input);
            border: 1px solid var(--primary);
            color: var(--primary);
            border-radius: 4px;
            cursor: pointer;
            font-weight: 700;
        }
        .zoom-btn:hover { background: var(--primary); color: #000; }

        .search-box {
            width: 100%;
            padding: 8px 12px;
            background: var(--bg-input);
            border: 1px solid var(--primary);
            color: var(--text);
            border-radius: 5px;
            font-size: 12px;
            margin-bottom: 10px;
        }
    </style>
</head>
<body>
    <!-- Notifications Container -->
    <div class="notifications-container" id="notificationsContainer"></div>

    <div class="toggle-panel panel-visible" id="toggleBtn" onclick="togglePanel()">âš™ï¸ Ø§Ù„ØªØ­ÙƒÙ…</div>
    <button class="fullscreen-btn" onclick="toggleFullscreen()">â›¶ Ù…Ù„Ø¡ Ø§Ù„Ø´Ø§Ø´Ø©</button>

    <!-- Control Panel -->
    <div class="control-panel" id="controlPanel">
        <div class="panel-tabs">
            <div class="panel-tab active" onclick="switchTab('main')">ğŸ </div>
            <div class="panel-tab" onclick="switchTab('forms')">ğŸ“ Ù†Ù…Ø§Ø°Ø¬</div>
            <div class="panel-tab" onclick="switchTab('buses')">ğŸšŒ Ø­Ø§ÙÙ„Ø§Øª<span class="badge" id="busCount">0</span></div>
            <div class="panel-tab" onclick="switchTab('alerts')">ğŸ””<span class="badge" id="alertCount">0</span></div>
            <div class="panel-tab" onclick="switchTab('settings')">âš™ï¸</div>
        </div>

        <div class="panel-content">
            <!-- Main Tab -->
            <div class="tab-content active" id="tab-main">
                <div class="control-section">
                    <div class="control-title">ğŸ” Ø§Ù„ØªÙƒØ¨ÙŠØ±</div>
                    <div class="zoom-btns">
                        <button class="zoom-btn" onclick="zoomOut()">â–</button>
                        <button class="zoom-btn" onclick="zoomReset()"><span id="zoomValue">100</span>%</button>
                        <button class="zoom-btn" onclick="zoomIn()">â•</button>
                    </div>
                </div>

                <div class="control-section">
                    <div class="control-title">ğŸ“Š Ø¥Ø­ØµØ§Ø¦ÙŠØ§Øª Ø§Ù„Ù…ÙˆØ§Ù‚Ù</div>
                    <div style="font-size:11px;line-height:2;color:var(--text-muted)">
                        <div>ğŸ“Œ Ø¥Ø¬Ù…Ø§Ù„ÙŠ Ø§Ù„Ù…ÙˆØ§Ù‚Ù: <b style="color:var(--primary)">87</b></div>
                        <div>âœ… Ù…Ø´ØºÙˆÙ„: <b id="statOccupied" style="color:var(--primary)">0</b></div>
                        <div>â¬œ ÙØ§Ø±Øº: <b id="statEmpty">87</b></div>
                        <div style="color:var(--green)">ğŸŸ¢ Ù…Ø¨ÙƒØ±: <b id="statEarly">0</b></div>
                        <div style="color:var(--blue)">ğŸ”µ ÙÙŠ Ø§Ù„Ù…ÙˆØ¹Ø¯: <b id="statOntime">0</b></div>
                        <div style="color:var(--red)">ğŸ”´ Ù…ØªØ£Ø®Ø±: <b id="statLate">0</b></div>
                    </div>
                </div>

                <div class="control-section" id="selectedActions" style="display:none">
                    <div class="control-title">ğŸ“ Ø§Ù„Ù…ÙˆÙ‚Ù #<span id="selectedNum">-</span></div>
                    <button class="control-button" onclick="viewBusDetails()">ğŸ‘ï¸ Ø¹Ø±Ø¶ Ø§Ù„ØªÙØ§ØµÙŠÙ„</button>
                    <button class="control-button info" onclick="openMoveModal()">ğŸ”„ Ù†Ù‚Ù„ Ø§Ù„Ø­Ø§ÙÙ„Ø©</button>
                    <button class="control-button danger" onclick="deleteFromSpot()">ğŸ—‘ï¸ Ø¥Ø®Ù„Ø§Ø¡ Ø§Ù„Ù…ÙˆÙ‚Ù</button>
                </div>

                <div class="control-section">
                    <div class="control-title">ğŸ’¾ Ø¥Ø¯Ø§Ø±Ø© Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª</div>
                    <button class="control-button" onclick="exportJSON()">ğŸ’¾ ØªØµØ¯ÙŠØ± JSON</button>
                    <button class="control-button info" onclick="exportCSV()">ğŸ“Š ØªØµØ¯ÙŠØ± CSV</button>
                    <button class="control-button" onclick="document.getElementById('importFile').click()">ğŸ“¥ Ø§Ø³ØªÙŠØ±Ø§Ø¯</button>
                    <input type="file" id="importFile" accept=".json" style="display:none" onchange="importJSON(event)">
                    <button class="control-button danger" onclick="resetAll()">ğŸ”„ Ù…Ø³Ø­ Ø§Ù„ÙƒÙ„</button>
                </div>
            </div>

            <!-- Forms Tab -->
            <div class="tab-content" id="tab-forms">
                <div class="control-section">
                    <div class="control-title">ğŸ“ Ø§Ù„Ù†Ù…Ø§Ø°Ø¬ Ø§Ù„Ù…ØªØ§Ø­Ø©</div>
                    <p style="font-size:10px;color:var(--text-muted);margin-bottom:10px">Ø§Ø®ØªØ± Ù†Ù…ÙˆØ°Ø¬ Ù„ØªØ³Ø¬ÙŠÙ„ Ø¨ÙŠØ§Ù†Ø§Øª Ø¬Ø¯ÙŠØ¯Ø©</p>
                    
                    <div class="form-list-item" onclick="openForm('ScrLogIn')">
                        <div class="form-name">1ï¸âƒ£ ScrLogIn</div>
                        <div class="form-name-ar">ØªØ³Ø¬ÙŠÙ„ Ø§Ù„Ø¯Ø®ÙˆÙ„</div>
                    </div>
                    
                    <div class="form-list-item" onclick="openForm('ScrSegregationIn')">
                        <div class="form-name">2ï¸âƒ£ ScrSegregationIn</div>
                        <div class="form-name-ar">Ø¯Ø®ÙˆÙ„ Ø§Ù„Ø­Ø§ÙÙ„Ø§Øª Ù„Ù„ÙØ±Ø²</div>
                    </div>
                    
                    <div class="form-list-item" onclick="openForm('ScrWelcomeLounge')">
                        <div class="form-name">3ï¸âƒ£ ScrWelcomeLounge</div>
                        <div class="form-name-ar">ØµØ§Ù„Ø© Ø§Ù„ØªØ±Ø­ÙŠØ¨ â­</div>
                    </div>
                    
                    <div class="form-list-item" onclick="openForm('ScrSegregationExit')">
                        <div class="form-name">4ï¸âƒ£ ScrSegregationExit</div>
                        <div class="form-name-ar">Ø®Ø±ÙˆØ¬ Ø§Ù„Ø­Ø§ÙÙ„Ø§Øª Ù…Ù† Ø§Ù„ÙØ±Ø²</div>
                    </div>
                    
                    <div class="form-list-item" onclick="openForm('ScrCurbside')">
                        <div class="form-name">5ï¸âƒ£ ScrCurbside</div>
                        <div class="form-name-ar">Ø§Ù„Ø±ØµÙŠÙ</div>
                    </div>
                </div>
            </div>

            <!-- Buses Tab -->
            <div class="tab-content" id="tab-buses">
                <div class="control-section">
                    <div class="control-title">ğŸšŒ Ø§Ù„Ø­Ø§ÙÙ„Ø§Øª Ø§Ù„Ù…Ø³Ø¬Ù„Ø©</div>
                    <input type="text" class="search-box" placeholder="ğŸ” Ø¨Ø­Ø« Ø¨Ø§Ù„ÙˆØ­Ø© Ø£Ùˆ Ø±Ù‚Ù… Ø§Ù„Ø±Ø­Ù„Ø©..." oninput="filterBusList(this.value)">
                    <div id="busList"></div>
                </div>
            </div>

            <!-- Alerts Tab -->
            <div class="tab-content" id="tab-alerts">
                <div class="control-section">
                    <div class="control-title">ğŸ”” Ø³Ø¬Ù„ Ø§Ù„ØªÙ†Ø¨ÙŠÙ‡Ø§Øª ÙˆØ§Ù„Ø£Ø­Ø¯Ø§Ø«</div>
                    <button class="control-button danger" onclick="clearAlerts()" style="margin-bottom:10px">ğŸ—‘ï¸ Ù…Ø³Ø­ Ø§Ù„Ø³Ø¬Ù„</button>
                    <div class="alerts-container" id="alertsList"></div>
                </div>
            </div>

            <!-- Settings Tab -->
            <div class="tab-content" id="tab-settings">
                <div class="control-section">
                    <div class="control-title">â±ï¸ Ø­Ø¯ÙˆØ¯ Ø§Ù„ØªÙÙˆÙŠØ¬ (Ø¨Ø§Ù„Ø³Ø§Ø¹Ø§Øª)</div>
                    <div class="control-row">
                        <div class="control-group">
                            <label class="control-label">Ù…Ø¨ÙƒØ± Ø£ÙƒØ¨Ø± Ù…Ù†</label>
                            <input type="number" class="control-input" id="earlyThreshold" value="7" min="1" onchange="updateThresholds()">
                        </div>
                        <div class="control-group">
                            <label class="control-label">Ù…ØªØ£Ø®Ø± Ø£Ù‚Ù„ Ù…Ù†</label>
                            <input type="number" class="control-input" id="lateThreshold" value="3" min="1" onchange="updateThresholds()">
                        </div>
                    </div>
                </div>

                <div class="control-section">
                    <div class="control-title">ğŸ”” Ø¥Ø¹Ø¯Ø§Ø¯Ø§Øª Ø§Ù„ØªÙ†Ø¨ÙŠÙ‡Ø§Øª</div>
                    <label style="font-size:10px;display:flex;align-items:center;gap:8px;margin-bottom:8px">
                        <input type="checkbox" id="soundEnabled" checked> ØªÙØ¹ÙŠÙ„ Ø§Ù„ØµÙˆØª
                    </label>
                    <label style="font-size:10px;display:flex;align-items:center;gap:8px">
                        <input type="checkbox" id="notifyEnabled" checked> ØªÙØ¹ÙŠÙ„ Ø§Ù„Ø¥Ø´Ø¹Ø§Ø±Ø§Øª
                    </label>
                </div>

                <div class="control-section">
                    <div class="control-title">ğŸ’¾ Ø§Ù„Ø¥Ø¹Ø¯Ø§Ø¯Ø§Øª</div>
                    <button class="control-button" onclick="saveSettings()">ğŸ’¾ Ø­ÙØ¸ Ø§Ù„Ø¥Ø¹Ø¯Ø§Ø¯Ø§Øª</button>
                    <button class="control-button danger" onclick="resetSettings()">ğŸ”„ Ø¥Ø¹Ø§Ø¯Ø© ØªØ¹ÙŠÙŠÙ†</button>
                </div>
            </div>
        </div>
    </div>

    <!-- Header -->
    <header class="header panel-open" id="header">
        <div class="header-title">ğŸšŒ Ø¥Ø¯Ø§Ø±Ø© Ø¹Ù…Ù„ÙŠØ§Øª Ø§Ù„Ø³Ø§Ø­Ø§Øª Ø§Ù„Ø®Ø§Ø±Ø¬ÙŠØ© ÙˆØ§Ù„Ù…ÙˆØ§ØµÙ„Ø§Øª</div>
        <div class="header-controls">
            <div class="header-btn" id="timeDisplay">--:--:--</div>
            <div class="header-btn" id="shiftDisplay">Ù†ÙˆØ¨Ø© -</div>
            <div class="header-btn" id="dateDisplay">--/--/----</div>
        </div>
    </header>

    <!-- Daily Stats -->
    <div class="daily-stats panel-open" id="dailyStats">
        <div class="daily-stat">
            <span>ğŸ‘¥</span>
            <div>
                <div class="daily-stat-value" id="dailyPax">0</div>
                <div class="daily-stat-label">Ù…Ø³Ø§ÙØ± Ø§Ù„ÙŠÙˆÙ…</div>
            </div>
        </div>
        <div class="daily-stat">
            <span>ğŸšŒ</span>
            <div>
                <div class="daily-stat-value" id="dailyBuses">0</div>
                <div class="daily-stat-label">Ø­Ø§ÙÙ„Ø© Ø§Ù„ÙŠÙˆÙ…</div>
            </div>
        </div>
        <div class="daily-stat">
            <span>âœˆï¸</span>
            <div>
                <div class="daily-stat-value" id="dailyFlights">0</div>
                <div class="daily-stat-label">Ø±Ø­Ù„Ø© Ø§Ù„ÙŠÙˆÙ…</div>
            </div>
        </div>
        <div class="daily-stat">
            <span>ğŸ“Š</span>
            <div>
                <div class="daily-stat-value" id="occupancyRate">0%</div>
                <div class="daily-stat-label">Ù†Ø³Ø¨Ø© Ø§Ù„Ø¥Ø´ØºØ§Ù„</div>
            </div>
        </div>
    </div>

    <!-- Stats Bar -->
    <div class="stats-bar panel-open" id="statsBar">
        <div class="stat-card" onclick="filterByStatus('all')">
            <div class="stat-value" id="totalInParking">0</div>
            <div class="stat-label">Ø¥Ø¬Ù…Ø§Ù„ÙŠ ÙÙŠ Ø§Ù„Ù…ÙˆØ§Ù‚Ù</div>
        </div>
        <div class="stat-card green" onclick="filterByStatus('early')">
            <div class="stat-value" id="earlyCount">0</div>
            <div class="stat-label">ğŸŸ¢ Ù…Ø¨ÙƒØ± (>7 Ø³Ø§Ø¹Ø§Øª)</div>
        </div>
        <div class="stat-card blue" onclick="filterByStatus('ontime')">
            <div class="stat-value" id="ontimeCount">0</div>
            <div class="stat-label">ğŸ”µ ÙÙŠ Ø§Ù„Ù…ÙˆØ¹Ø¯ (3-7)</div>
        </div>
        <div class="stat-card red" onclick="filterByStatus('late')">
            <div class="stat-value" id="lateCount">0</div>
            <div class="stat-label">ğŸ”´ Ù…ØªØ£Ø®Ø± (&lt;3 Ø³Ø§Ø¹Ø§Øª)</div>
        </div>
    </div>

    <!-- Main Container -->
    <main class="main-container panel-open" id="mainContainer">
        <div class="parking-wrapper" id="parkingWrapper"></div>
    </main>

    <!-- Form Modal -->
    <div class="modal" id="formModal">
        <div class="modal-content">
            <div class="modal-header">
                <span id="formModalTitle">Ù†Ù…ÙˆØ°Ø¬</span>
                <button class="modal-close" onclick="closeModal('formModal')">&times;</button>
            </div>
            <div id="formModalBody"></div>
            <div class="modal-buttons">
                <button class="modal-btn primary" onclick="saveForm()">ğŸ’¾ Ø­ÙØ¸</button>
                <button class="modal-btn secondary" onclick="closeModal('formModal')">Ø¥Ù„ØºØ§Ø¡</button>
            </div>
        </div>
    </div>

    <!-- Move Modal -->
    <div class="modal" id="moveModal">
        <div class="modal-content">
            <div class="modal-header">
                <span>ğŸ”„ Ù†Ù‚Ù„ Ø§Ù„Ø­Ø§ÙÙ„Ø©</span>
                <button class="modal-close" onclick="closeModal('moveModal')">&times;</button>
            </div>
            <div class="form-row">
                <div class="form-group">
                    <label class="form-label">Ù…Ù† Ø§Ù„Ù…ÙˆÙ‚Ù</label>
                    <input type="number" class="form-input" id="moveFrom" readonly>
                </div>
                <div class="form-group">
                    <label class="form-label">Ø¥Ù„Ù‰ Ø§Ù„Ù…ÙˆÙ‚Ù</label>
                    <input type="number" class="form-input" id="moveTo" min="1" max="87">
                </div>
            </div>
            <div class="modal-buttons">
                <button class="modal-btn primary" onclick="moveBus()">âœ… Ù†Ù‚Ù„</button>
                <button class="modal-btn secondary" onclick="closeModal('moveModal')">Ø¥Ù„ØºØ§Ø¡</button>
            </div>
        </div>
    </div>

    <!-- Bus Details Modal -->
    <div class="modal" id="detailsModal">
        <div class="modal-content">
            <div class="modal-header">
                <span>ğŸ“‹ ØªÙØ§ØµÙŠÙ„ Ø§Ù„Ø­Ø§ÙÙ„Ø©</span>
                <button class="modal-close" onclick="closeModal('detailsModal')">&times;</button>
            </div>
            <div id="detailsBody"></div>
            <div class="modal-buttons">
                <button class="modal-btn secondary" onclick="closeModal('detailsModal')">Ø¥ØºÙ„Ø§Ù‚</button>
            </div>
        </div>
    </div>

    <!-- Tooltip -->
    <div class="tooltip" id="tooltip"></div>

    <script>
        // â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
        // DATA STRUCTURES - Power BI Best Practices
        // â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
        
        // Main data store - like Power BI Fact Table
        let busRecords = [];
        
        // Configuration - like Power BI Parameters
        let config = {
            thresholds: { early: 7, late: 3 },
            sound: true,
            notify: true
        };
        
        // State management
        let selectedSpot = null;
        let currentFilter = 'all';
        let panelVisible = true;
        let zoomLevel = 100;
        let alerts = [];
        let currentFormType = null;
        let currentEditBus = null;

        // Form definitions - Power BI Data Model
        const FORMS = {
            ScrLogIn: {
                title: 'ØªØ³Ø¬ÙŠÙ„ Ø§Ù„Ø¯Ø®ÙˆÙ„',
                fields: [
                    { id: 'WorkLoc', label: 'Ù…ÙˆÙ‚Ø¹ Ø§Ù„Ø¹Ù…Ù„', type: 'select', options: ['ScrLogIn', 'ScrSegregationIn', 'ScrWelcomeLounge', 'ScrSegregationExit', 'ScrCurbside'] }
                ]
            },
            ScrSegregationIn: {
                title: 'Ø¯Ø®ÙˆÙ„ Ø§Ù„Ø­Ø§ÙÙ„Ø§Øª Ù„Ù„ÙØ±Ø²',
                fields: [
                    { id: 'BusPlate', label: 'Ù„ÙˆØ­Ø© Ø§Ù„Ø­Ø§ÙÙ„Ø©', type: 'text' },
                    { id: 'BusNO', label: 'Ø±Ù‚Ù… Ø§Ù„Ø­Ø§ÙÙ„Ø©', type: 'number' },
                    { id: 'FlightNo', label: 'Ø±Ù‚Ù… Ø§Ù„Ø±Ø­Ù„Ø©', type: 'text' },
                    { id: 'TripCount', label: 'Ø¹Ø¯Ø¯ Ø§Ù„Ø±Ø­Ù„Ø§Øª', type: 'number' },
                    { id: 'DepDate', label: 'ØªØ§Ø±ÙŠØ® Ø§Ù„Ù…ØºØ§Ø¯Ø±Ø©', type: 'date' },
                    { id: 'DepHour', label: 'Ø³Ø§Ø¹Ø© Ø§Ù„Ù…ØºØ§Ø¯Ø±Ø©', type: 'hour' },
                    { id: 'DepMin', label: 'Ø¯Ù‚ÙŠÙ‚Ø© Ø§Ù„Ù…ØºØ§Ø¯Ø±Ø©', type: 'minute' },
                    { id: 'CurDate', label: 'ØªØ§Ø±ÙŠØ® Ø§Ù„Ø¯Ø®ÙˆÙ„', type: 'date' },
                    { id: 'CurHour', label: 'Ø³Ø§Ø¹Ø© Ø§Ù„Ø¯Ø®ÙˆÙ„', type: 'hour' },
                    { id: 'CurMin', label: 'Ø¯Ù‚ÙŠÙ‚Ø© Ø§Ù„Ø¯Ø®ÙˆÙ„', type: 'minute' },
                    { id: 'TerminalCd', label: 'ÙƒÙˆØ¯ Ø§Ù„Ù…Ø¨Ù†Ù‰', type: 'select', options: ['HT', 'NT', 'T1'] },
                    { id: 'TotalPax', label: 'Ø¥Ø¬Ù…Ø§Ù„ÙŠ Ø§Ù„Ø±ÙƒØ§Ø¨', type: 'number' },
                    { id: 'PaxCount', label: 'Ø¹Ø¯Ø¯ Ø§Ù„Ø±ÙƒØ§Ø¨', type: 'number' },
                    { id: 'Destination', label: 'Ø§Ù„ÙˆØ¬Ù‡Ø©', type: 'text' },
                    { id: 'DispatchSts', label: 'Ø­Ø§Ù„Ø© Ø§Ù„Ø¥Ø±Ø³Ø§Ù„', type: 'select', options: ['Ø®Ø§Ø·Ø¦', 'Ù…Ø¨ÙƒØ±', 'Ù…ØªØ£Ø®Ø±', 'Ù…Ø´ØªØ±Ùƒ Ø±Ø­Ù„Ø§Øª', 'Ù…Ø´ØªØ±Ùƒ Ø±Ø­Ù„Ø§Øª ÙˆØµØ§Ù„Ø§Øª'] },
                    { id: 'VisaType', label: 'Ù†ÙˆØ¹ Ø§Ù„ØªØ£Ø´ÙŠØ±Ø©', type: 'select', options: ['Hajj', 'GCC', 'Visit', 'Tourism', 'Work'] },
                    { id: 'UmrahCop', label: 'Ø´Ø±ÙƒØ© Ø§Ù„Ø¹Ù…Ø±Ø©', type: 'text' }
                ]
            },
            ScrWelcomeLounge: {
                title: 'ØµØ§Ù„Ø© Ø§Ù„ØªØ±Ø­ÙŠØ¨',
                fields: [
                    { id: 'BusPlate', label: 'Ù„ÙˆØ­Ø© Ø§Ù„Ø­Ø§ÙÙ„Ø©', type: 'text' },
                    { id: 'BusNO', label: 'Ø±Ù‚Ù… Ø§Ù„Ø­Ø§ÙÙ„Ø©', type: 'number' },
                    { id: 'ParkNO', label: 'Ø±Ù‚Ù… Ø§Ù„Ù…ÙˆÙ‚Ù (1-87)', type: 'number', min: 1, max: 87 },
                    { id: 'BagStatus', label: 'Ø­Ø§Ù„Ø© Ø§Ù„Ø£Ù…ØªØ¹Ø©', type: 'select', options: ['Ø¯ÙŠÙ†Ø©', 'Ù„Ø§ ÙŠÙˆØ¬Ø¯', 'Ù…Ø®ØªÙ„Ø·'] },
                    { id: 'T3CALLDate', label: 'ØªØ§Ø±ÙŠØ® Ø§Ù„Ø§ØªØµØ§Ù„', type: 'date' },
                    { id: 'T3CALLHour', label: 'Ø³Ø§Ø¹Ø© Ø§Ù„Ø§ØªØµØ§Ù„', type: 'hour' },
                    { id: 'T3CALLMin', label: 'Ø¯Ù‚ÙŠÙ‚Ø© Ø§Ù„Ø§ØªØµØ§Ù„', type: 'minute' },
                    { id: 'FlightSts', label: 'Ø­Ø§Ù„Ø© Ø§Ù„Ø±Ø­Ù„Ø©', type: 'select', options: ['Ø£Ù‚Ù„Ø¹Øª', 'Ø£ÙÙ„ØºÙŠØª', 'Ù…ØªØ£Ø®Ø±Ø©'] },
                    { id: 'T3ACT', label: 'Ø§Ù„ÙˆØµÙˆÙ„ Ø§Ù„ÙØ¹Ù„ÙŠ', type: 'select', options: ['Approval', 'Waiting'] },
                    { id: 'GetaNO', label: 'Ø±Ù‚Ù… Ø§Ù„Ø¨ÙˆØ§Ø¨Ø©', type: 'select', options: ['A1', 'A2', 'B1', 'B2', 'C1', 'C2', 'D1', 'D2', 'E1', 'E2'] },
                    { id: 'T3APRODate', label: 'ØªØ§Ø±ÙŠØ® Ø§Ù„Ø§Ù‚ØªØ±Ø§Ø¨', type: 'date' },
                    { id: 'T3APROHour', label: 'Ø³Ø§Ø¹Ø© Ø§Ù„Ø§Ù‚ØªØ±Ø§Ø¨', type: 'hour' },
                    { id: 'T3APROMin', label: 'Ø¯Ù‚ÙŠÙ‚Ø© Ø§Ù„Ø§Ù‚ØªØ±Ø§Ø¨', type: 'minute' }
                ]
            },
            ScrSegregationExit: {
                title: 'Ø®Ø±ÙˆØ¬ Ø§Ù„Ø­Ø§ÙÙ„Ø§Øª Ù…Ù† Ø§Ù„ÙØ±Ø²',
                fields: [
                    { id: 'BusPlate', label: 'Ù„ÙˆØ­Ø© Ø§Ù„Ø­Ø§ÙÙ„Ø©', type: 'text' },
                    { id: 'BusNO', label: 'Ø±Ù‚Ù… Ø§Ù„Ø­Ø§ÙÙ„Ø©', type: 'number' },
                    { id: 'FlightNo', label: 'Ø±Ù‚Ù… Ø§Ù„Ø±Ø­Ù„Ø©', type: 'text' },
                    { id: 'ExitDate', label: 'ØªØ§Ø±ÙŠØ® Ø§Ù„Ø®Ø±ÙˆØ¬', type: 'date' },
                    { id: 'ExitHour', label: 'Ø³Ø§Ø¹Ø© Ø§Ù„Ø®Ø±ÙˆØ¬', type: 'hour' },
                    { id: 'ExitMin', label: 'Ø¯Ù‚ÙŠÙ‚Ø© Ø§Ù„Ø®Ø±ÙˆØ¬', type: 'minute' }
                ]
            },
            ScrCurbside: {
                title: 'Ø§Ù„Ø±ØµÙŠÙ',
                fields: [
                    { id: 'BusPlate', label: 'Ù„ÙˆØ­Ø© Ø§Ù„Ø­Ø§ÙÙ„Ø©', type: 'text' },
                    { id: 'BusNO', label: 'Ø±Ù‚Ù… Ø§Ù„Ø­Ø§ÙÙ„Ø©', type: 'number' },
                    { id: 'BusArrDate', label: 'ØªØ§Ø±ÙŠØ® ÙˆØµÙˆÙ„ Ø§Ù„Ø­Ø§ÙÙ„Ø©', type: 'date' },
                    { id: 'BusArrHour', label: 'Ø³Ø§Ø¹Ø© Ø§Ù„ÙˆØµÙˆÙ„', type: 'hour' },
                    { id: 'BusArrMin', label: 'Ø¯Ù‚ÙŠÙ‚Ø© Ø§Ù„ÙˆØµÙˆÙ„', type: 'minute' },
                    { id: 'PaxDisembarkDate', label: 'ØªØ§Ø±ÙŠØ® Ù†Ø²ÙˆÙ„ Ø§Ù„Ø±ÙƒØ§Ø¨', type: 'date' },
                    { id: 'PaxDisembarkHour', label: 'Ø³Ø§Ø¹Ø© Ø§Ù„Ù†Ø²ÙˆÙ„', type: 'hour' },
                    { id: 'PaxDisembarkMin', label: 'Ø¯Ù‚ÙŠÙ‚Ø© Ø§Ù„Ù†Ø²ÙˆÙ„', type: 'minute' },
                    { id: 'BusDepDate', label: 'ØªØ§Ø±ÙŠØ® Ù…ØºØ§Ø¯Ø±Ø© Ø§Ù„Ø­Ø§ÙÙ„Ø©', type: 'date' },
                    { id: 'BusDepHour', label: 'Ø³Ø§Ø¹Ø© Ø§Ù„Ù…ØºØ§Ø¯Ø±Ø©', type: 'hour' },
                    { id: 'BusDepMin', label: 'Ø¯Ù‚ÙŠÙ‚Ø© Ø§Ù„Ù…ØºØ§Ø¯Ø±Ø©', type: 'minute' },
                    { id: 'DelayReason', label: 'Ø³Ø¨Ø¨ Ø§Ù„ØªØ£Ø®ÙŠØ±', type: 'select', options: ['ZMZM', 'Operations', 'Bags', 'Passport Distribution'] },
                    { id: 'FlightSts', label: 'Ø­Ø§Ù„Ø© Ø§Ù„Ø±Ø­Ù„Ø©', type: 'select', options: ['Ø£Ù‚Ù„Ø¹Øª', 'Ø£ÙÙ„ØºÙŠØª', 'Ù…ØªØ£Ø®Ø±Ø©'] },
                    { id: 'GetaNO', label: 'Ø±Ù‚Ù… Ø§Ù„Ø¨ÙˆØ§Ø¨Ø©', type: 'select', options: ['A1', 'A2', 'B1', 'B2', 'C1', 'C2', 'D1', 'D2', 'E1', 'E2'] }
                ]
            }
        };

        // â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
        // NOTIFICATIONS SYSTEM
        // â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
        
        function showNotification(type, title, message, duration = 5000) {
            if (!config.notify) return;
            
            const container = document.getElementById('notificationsContainer');
            const icons = { success: 'âœ…', error: 'âŒ', warning: 'âš ï¸', info: 'â„¹ï¸' };
            
            const notif = document.createElement('div');
            notif.className = `notification ${type}`;
            notif.innerHTML = `
                <span class="notification-icon">${icons[type]}</span>
                <div class="notification-content">
                    <div class="notification-title">${title}</div>
                    <div class="notification-message">${message}</div>
                </div>
                <button class="notification-close" onclick="this.parentElement.remove()">&times;</button>
            `;
            
            container.appendChild(notif);
            
            setTimeout(() => notif.remove(), duration);
            
            // Add to alerts log
            addAlert(type === 'error' ? 'critical' : type, `${title}: ${message}`);
        }

        // â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
        // ALERTS LOG
        // â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
        
        function addAlert(type, message) {
            const now = new Date();
            alerts.unshift({
                type,
                message,
                time: now.toLocaleTimeString('ar-SA'),
                date: now.toLocaleDateString('ar-SA')
            });
            
            if (alerts.length > 100) alerts.pop();
            
            renderAlerts();
            updateAlertBadge();
        }

        function renderAlerts() {
            const container = document.getElementById('alertsList');
            const icons = { critical: 'ğŸš¨', warning: 'âš ï¸', info: 'â„¹ï¸', success: 'âœ…' };
            
            if (alerts.length === 0) {
                container.innerHTML = '<div style="text-align:center;padding:30px;color:var(--text-muted)">Ù„Ø§ ØªÙˆØ¬Ø¯ ØªÙ†Ø¨ÙŠÙ‡Ø§Øª</div>';
                return;
            }
            
            container.innerHTML = alerts.map(a => `
                <div class="alert-item ${a.type}">
                    <span class="alert-icon">${icons[a.type]}</span>
                    <div class="alert-content">
                        <div class="alert-message">${a.message}</div>
                        <div class="alert-time">${a.date} - ${a.time}</div>
                    </div>
                </div>
            `).join('');
        }

        function clearAlerts() {
            alerts = [];
            renderAlerts();
            updateAlertBadge();
            showNotification('info', 'ØªÙ… Ø§Ù„Ù…Ø³Ø­', 'ØªÙ… Ù…Ø³Ø­ Ø³Ø¬Ù„ Ø§Ù„ØªÙ†Ø¨ÙŠÙ‡Ø§Øª');
        }

        function updateAlertBadge() {
            document.getElementById('alertCount').textContent = alerts.length;
        }

        // â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
        // FORM GENERATION
        // â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
        
        function openForm(formType, busPlate = null) {
            currentFormType = formType;
            currentEditBus = busPlate ? busRecords.find(b => b.BusPlate === busPlate) : null;
            
            const form = FORMS[formType];
            document.getElementById('formModalTitle').textContent = `ğŸ“ ${form.title}`;
            
            let html = '';
            const fields = form.fields;
            
            for (let i = 0; i < fields.length; i += 2) {
                html += '<div class="form-row">';
                html += generateFieldHTML(fields[i]);
                if (fields[i + 1]) {
                    html += generateFieldHTML(fields[i + 1]);
                }
                html += '</div>';
            }
            
            document.getElementById('formModalBody').innerHTML = html;
            
            // Pre-fill if editing
            if (currentEditBus) {
                fields.forEach(f => {
                    const el = document.getElementById('field_' + f.id);
                    if (el && currentEditBus[f.id] !== undefined) {
                        el.value = currentEditBus[f.id];
                    }
                });
            }
            
            document.getElementById('formModal').classList.add('active');
        }

        function generateFieldHTML(field) {
            let inputHTML = '';
            const value = currentEditBus ? (currentEditBus[field.id] || '') : '';
            
            switch (field.type) {
                case 'text':
                    inputHTML = `<input type="text" class="form-input" id="field_${field.id}" value="${value}">`;
                    break;
                case 'number':
                    const min = field.min ? `min="${field.min}"` : '';
                    const max = field.max ? `max="${field.max}"` : '';
                    inputHTML = `<input type="number" class="form-input" id="field_${field.id}" value="${value}" ${min} ${max}>`;
                    break;
                case 'date':
                    inputHTML = `<input type="date" class="form-input" id="field_${field.id}" value="${value}">`;
                    break;
                case 'hour':
                    let hourOptions = '';
                    for (let h = 0; h < 24; h++) {
                        const hStr = h.toString().padStart(2, '0');
                        hourOptions += `<option value="${hStr}" ${value == hStr ? 'selected' : ''}>${hStr}</option>`;
                    }
                    inputHTML = `<select class="form-select" id="field_${field.id}">${hourOptions}</select>`;
                    break;
                case 'minute':
                    let minOptions = '';
                    for (let m = 0; m < 60; m++) {
                        const mStr = m.toString().padStart(2, '0');
                        minOptions += `<option value="${mStr}" ${value == mStr ? 'selected' : ''}>${mStr}</option>`;
                    }
                    inputHTML = `<select class="form-select" id="field_${field.id}">${minOptions}</select>`;
                    break;
                case 'select':
                    let options = field.options.map(o => 
                        `<option value="${o}" ${value === o ? 'selected' : ''}>${o}</option>`
                    ).join('');
                    inputHTML = `<select class="form-select" id="field_${field.id}"><option value="">-- Ø§Ø®ØªØ± --</option>${options}</select>`;
                    break;
            }
            
            return `
                <div class="form-group">
                    <label class="form-label">${field.label}</label>
                    ${inputHTML}
                </div>
            `;
        }

        function saveForm() {
            const form = FORMS[currentFormType];
            const data = { formType: currentFormType, timestamp: new Date().toISOString() };
            
            form.fields.forEach(f => {
                const el = document.getElementById('field_' + f.id);
                if (el) data[f.id] = el.value;
            });
            
            // Find or create bus record by BusPlate
            const busPlate = data.BusPlate;
            if (!busPlate) {
                showNotification('warning', 'ØªÙ†Ø¨ÙŠÙ‡', 'ÙŠØ±Ø¬Ù‰ Ø¥Ø¯Ø®Ø§Ù„ Ù„ÙˆØ­Ø© Ø§Ù„Ø­Ø§ÙÙ„Ø©');
                return;
            }
            
            let bus = busRecords.find(b => b.BusPlate === busPlate);
            
            if (!bus) {
                bus = { BusPlate: busPlate, forms: {}, createdAt: new Date().toISOString() };
                busRecords.push(bus);
            }
            
            // Save form data
            bus.forms[currentFormType] = data;
            bus.lastUpdated = new Date().toISOString();
            
            // Copy important fields to bus level
            Object.assign(bus, data);
            
            closeModal('formModal');
            save();
            render();
            renderBusList();
            
            showNotification('success', 'ØªÙ… Ø§Ù„Ø­ÙØ¸', `ØªÙ… Ø­ÙØ¸ ${form.title} Ù„Ù„Ø­Ø§ÙÙ„Ø© ${busPlate}`);
            
            // Check if now visible in parking
            if (currentFormType === 'ScrWelcomeLounge' && data.ParkNO) {
                showNotification('info', 'ØªÙ… Ø§Ù„ØªØ¹ÙŠÙŠÙ†', `Ø§Ù„Ø­Ø§ÙÙ„Ø© ${busPlate} ÙÙŠ Ø§Ù„Ù…ÙˆÙ‚Ù Ø±Ù‚Ù… ${data.ParkNO}`);
            }
        }

        // â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
        // BUS LIST
        // â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
        
        function renderBusList(filter = '') {
            const container = document.getElementById('busList');
            document.getElementById('busCount').textContent = busRecords.length;
            
            let filtered = busRecords;
            if (filter) {
                const f = filter.toLowerCase();
                filtered = busRecords.filter(b => 
                    (b.BusPlate && b.BusPlate.toLowerCase().includes(f)) ||
                    (b.FlightNo && b.FlightNo.toLowerCase().includes(f))
                );
            }
            
            if (filtered.length === 0) {
                container.innerHTML = '<div style="text-align:center;padding:30px;color:var(--text-muted)">Ù„Ø§ ØªÙˆØ¬Ø¯ Ø­Ø§ÙÙ„Ø§Øª Ù…Ø³Ø¬Ù„Ø©</div>';
                return;
            }
            
            container.innerHTML = filtered.map(bus => {
                const inParking = bus.forms && bus.forms.ScrWelcomeLounge && bus.forms.ScrWelcomeLounge.ParkNO;
                const formsDone = Object.keys(bus.forms || {}).length;
                
                return `
                    <div class="bus-list-item ${inParking ? 'in-parking' : ''}" onclick="openBusForEdit('${bus.BusPlate}')">
                        <div class="bus-plate">ğŸšŒ ${bus.BusPlate}</div>
                        <div class="bus-flight">âœˆï¸ ${bus.FlightNo || '-'} | ğŸ‘¥ ${bus.PaxCount || bus.TotalPax || '-'}</div>
                        <div class="bus-details">
                            ${inParking ? 'ğŸ“ Ù…ÙˆÙ‚Ù: ' + bus.forms.ScrWelcomeLounge.ParkNO : 'â³ Ù„Ù… ÙŠØ¯Ø®Ù„ Ø§Ù„Ù…ÙˆÙ‚Ù Ø¨Ø¹Ø¯'}
                            | Ø§Ù„Ù†Ù…Ø§Ø°Ø¬: ${formsDone}/5
                        </div>
                        <div class="progress-bar">
                            <div class="progress-step ${bus.forms?.ScrLogIn ? 'done' : ''}"></div>
                            <div class="progress-step ${bus.forms?.ScrSegregationIn ? 'done' : ''}"></div>
                            <div class="progress-step ${bus.forms?.ScrWelcomeLounge ? 'done' : ''}"></div>
                            <div class="progress-step ${bus.forms?.ScrSegregationExit ? 'done' : ''}"></div>
                            <div class="progress-step ${bus.forms?.ScrCurbside ? 'done' : ''}"></div>
                        </div>
                    </div>
                `;
            }).join('');
        }

        function filterBusList(value) {
            renderBusList(value);
        }

        function openBusForEdit(busPlate) {
            const bus = busRecords.find(b => b.BusPlate === busPlate);
            if (!bus) return;
            
            // Find next form to complete
            const formOrder = ['ScrLogIn', 'ScrSegregationIn', 'ScrWelcomeLounge', 'ScrSegregationExit', 'ScrCurbside'];
            
            for (const formType of formOrder) {
                if (!bus.forms || !bus.forms[formType]) {
                    openForm(formType, busPlate);
                    return;
                }
            }
            
            // All forms completed - show details
            viewBusFullDetails(busPlate);
        }

        function viewBusFullDetails(busPlate) {
            const bus = busRecords.find(b => b.BusPlate === busPlate);
            if (!bus) return;
            
            let html = `<h3 style="color:var(--primary);margin-bottom:15px">ğŸšŒ ${bus.BusPlate}</h3>`;
            
            const formOrder = ['ScrLogIn', 'ScrSegregationIn', 'ScrWelcomeLounge', 'ScrSegregationExit', 'ScrCurbside'];
            
            formOrder.forEach(formType => {
                const formData = bus.forms?.[formType];
                const formDef = FORMS[formType];
                
                html += `<div style="background:var(--bg-input);padding:10px;border-radius:6px;margin-bottom:10px;">`;
                html += `<div style="color:${formData ? 'var(--green)' : 'var(--text-muted)'};font-weight:700;margin-bottom:8px">`;
                html += `${formData ? 'âœ…' : 'â¬œ'} ${formDef.title}</div>`;
                
                if (formData) {
                    formDef.fields.forEach(f => {
                        if (formData[f.id]) {
                            html += `<div style="font-size:10px;margin:3px 0"><b>${f.label}:</b> ${formData[f.id]}</div>`;
                        }
                    });
                }
                html += `</div>`;
            });
            
            document.getElementById('detailsBody').innerHTML = html;
            document.getElementById('detailsModal').classList.add('active');
        }

        // â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
        // STATUS CALCULATION - Power BI DAX Logic
        // â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
        
        function getStatus(bus) {
            const welcomeData = bus.forms?.ScrWelcomeLounge || bus.forms?.ScrSegregationIn;
            if (!welcomeData) return null;
            
            // Get departure time
            let depDate = bus.DepDate || welcomeData.DepDate;
            let depHour = bus.DepHour || welcomeData.DepHour;
            let depMin = bus.DepMin || welcomeData.DepMin;
            
            if (!depDate || !depHour) {
                // Fallback: use a default time
                const now = new Date();
                depDate = now.toISOString().split('T')[0];
                depHour = (now.getHours() + 5).toString().padStart(2, '0');
                depMin = '00';
            }
            
            const departure = new Date(`${depDate}T${depHour}:${depMin || '00'}`);
            const now = new Date();
            
            const diffMs = departure - now;
            const diffHours = diffMs / (1000 * 60 * 60);
            const diffMinutes = Math.floor(diffMs / (1000 * 60));
            
            let status, label;
            if (diffHours > config.thresholds.early) {
                status = 'early';
                label = 'Ù…Ø¨ÙƒØ±';
            } else if (diffHours < config.thresholds.late) {
                status = 'late';
                label = 'Ù…ØªØ£Ø®Ø±';
            } else {
                status = 'ontime';
                label = 'ÙÙŠ Ø§Ù„Ù…ÙˆØ¹Ø¯';
            }
            
            return { status, label, diffHours, diffMinutes, departure };
        }

        function formatCountdown(minutes) {
            if (minutes < 0) return 'Ø§Ù†ØªÙ‡Ù‰ Ø§Ù„ÙˆÙ‚Øª!';
            const h = Math.floor(minutes / 60);
            const m = minutes % 60;
            if (h > 0) {
                return `${h}Ø³ ${m}Ø¯`;
            }
            return `${m} Ø¯Ù‚ÙŠÙ‚Ø©`;
        }

        // â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
        // RENDER PARKING - Power BI Visual Logic
        // â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
        
        function render() {
            const wrapper = document.getElementById('parkingWrapper');
            wrapper.innerHTML = '';
            
            // Section 1: Entrance (1-42)
            wrapper.innerHTML += '<div class="section-label">ğŸšª Ø¬Ù‡Ø© Ø§Ù„Ù…Ø¯Ø®Ù„ (42 Ù…ÙˆÙ‚Ù)</div>';
            for (let i = 1; i <= 42; i++) {
                wrapper.appendChild(createSpot(i));
            }
            
            // Section 2: Exit (43-87)
            wrapper.innerHTML += '<div class="section-label">ğŸšª Ø¬Ù‡Ø© Ø§Ù„Ù…Ø®Ø±Ø¬ (45 Ù…ÙˆÙ‚Ù)</div>';
            for (let i = 43; i <= 87; i++) {
                wrapper.appendChild(createSpot(i));
            }
            
            updateStats();
        }

        function createSpot(num) {
            const spot = document.createElement('div');
            spot.className = 'parking-spot';
            spot.dataset.spot = num;
            
            // Find bus in this spot - ONLY if ScrWelcomeLounge is filled with ParkNO
            const bus = busRecords.find(b => {
                const welcomeForm = b.forms?.ScrWelcomeLounge;
                return welcomeForm && parseInt(welcomeForm.ParkNO) === num;
            });
            
            if (bus) {
                const statusInfo = getStatus(bus);
                
                if (statusInfo) {
                    if (currentFilter !== 'all' && statusInfo.status !== currentFilter) {
                        spot.style.opacity = '0.15';
                    }
                    
                    spot.classList.add(statusInfo.status);
                    if (selectedSpot === num) spot.classList.add('selected');
                    
                    const colors = { early: 'var(--green)', ontime: 'var(--blue)', late: 'var(--red)' };
                    const welcomeData = bus.forms.ScrWelcomeLounge;
                    
                    spot.innerHTML = `
                        <div class="spot-number">#${num}</div>
                        <div class="spot-badge" style="background:${colors[statusInfo.status]}">${statusInfo.label}</div>
                        <div class="bus-info">
                            <div class="info-line"><span class="info-icon">ğŸšŒ</span>${bus.BusPlate}</div>
                            <div class="info-line"><span class="info-icon">âœˆï¸</span>${bus.FlightNo || '-'}</div>
                            <div class="info-line"><span class="info-icon">ğŸ‘¥</span>${bus.PaxCount || bus.TotalPax || '-'}</div>
                            <div class="info-line"><span class="info-icon">ğŸšª</span>${welcomeData.GetaNO || '-'}</div>
                        </div>
                        <div class="countdown-timer ${statusInfo.status === 'late' ? 'urgent' : ''}" style="color:${colors[statusInfo.status]}">
                            <div class="timer-label">Ø§Ù„ÙˆÙ‚Øª Ø§Ù„Ù…ØªØ¨Ù‚ÙŠ</div>
                            <div class="timer-value" data-departure="${statusInfo.departure.toISOString()}">${formatCountdown(statusInfo.diffMinutes)}</div>
                        </div>
                    `;
                    
                    spot.onmouseenter = e => showTooltip(e, bus, statusInfo, num);
                    spot.onmousemove = moveTooltip;
                    spot.onmouseleave = hideTooltip;
                    spot.onclick = () => selectSpot(num, bus);
                }
            } else {
                spot.classList.add('empty');
                spot.innerHTML = `<div class="spot-number">#${num}</div><div class="empty-text">â€”</div>`;
                spot.onclick = () => {
                    // Quick add bus to this spot
                    document.getElementById('field_ParkNO')?.value;
                    openForm('ScrWelcomeLounge');
                    setTimeout(() => {
                        const parkInput = document.getElementById('field_ParkNO');
                        if (parkInput) parkInput.value = num;
                    }, 100);
                };
            }
            
            return spot;
        }

        // â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
        // COUNTDOWN UPDATE
        // â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
        
        function updateCountdowns() {
            document.querySelectorAll('.timer-value[data-departure]').forEach(el => {
                const dep = new Date(el.dataset.departure);
                const now = new Date();
                const diffMin = Math.floor((dep - now) / (1000 * 60));
                el.textContent = formatCountdown(diffMin);
                
                // Update urgency
                const timer = el.closest('.countdown-timer');
                if (diffMin < 60) {
                    timer.classList.add('urgent');
                } else {
                    timer.classList.remove('urgent');
                }
            });
        }

        // â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
        // STATS - Power BI Measures
        // â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
        
        function updateStats() {
            let early = 0, ontime = 0, late = 0, inParking = 0;
            let totalPax = 0;
            const flights = new Set();
            
            busRecords.forEach(bus => {
                if (bus.forms?.ScrWelcomeLounge?.ParkNO) {
                    inParking++;
                    const s = getStatus(bus);
                    if (s) {
                        if (s.status === 'early') early++;
                        else if (s.status === 'ontime') ontime++;
                        else late++;
                    }
                }
                totalPax += parseInt(bus.PaxCount || bus.TotalPax || 0);
                if (bus.FlightNo) flights.add(bus.FlightNo);
            });
            
            const occ = Math.round((inParking / 87) * 100);
            
            document.getElementById('totalInParking').textContent = inParking;
            document.getElementById('earlyCount').textContent = early;
            document.getElementById('ontimeCount').textContent = ontime;
            document.getElementById('lateCount').textContent = late;
            document.getElementById('occupancyRate').textContent = occ + '%';
            
            document.getElementById('statOccupied').textContent = inParking;
            document.getElementById('statEmpty').textContent = 87 - inParking;
            document.getElementById('statEarly').textContent = early;
            document.getElementById('statOntime').textContent = ontime;
            document.getElementById('statLate').textContent = late;
            
            document.getElementById('dailyBuses').textContent = busRecords.length;
            document.getElementById('dailyPax').textContent = totalPax.toLocaleString();
            document.getElementById('dailyFlights').textContent = flights.size;
            
            // Update red card animation
            const redCard = document.querySelector('.stat-card.red');
            if (late > 0) {
                redCard.style.animation = 'pulse-card 0.4s infinite';
            } else {
                redCard.style.animation = 'none';
            }
        }

        // â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
        // SPOT ACTIONS
        // â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
        
        function selectSpot(num, bus) {
            selectedSpot = num;
            document.getElementById('selectedNum').textContent = num;
            document.getElementById('selectedActions').style.display = 'block';
            render();
        }

        function viewBusDetails() {
            if (!selectedSpot) return;
            const bus = busRecords.find(b => 
                b.forms?.ScrWelcomeLounge && 
                parseInt(b.forms.ScrWelcomeLounge.ParkNO) === selectedSpot
            );
            if (bus) viewBusFullDetails(bus.BusPlate);
        }

        function openMoveModal() {
            if (!selectedSpot) return;
            document.getElementById('moveFrom').value = selectedSpot;
            document.getElementById('moveTo').value = '';
            document.getElementById('moveModal').classList.add('active');
        }

        function moveBus() {
            const from = parseInt(document.getElementById('moveFrom').value);
            const to = parseInt(document.getElementById('moveTo').value);
            
            if (!to || to < 1 || to > 87) {
                showNotification('error', 'Ø®Ø·Ø£', 'Ø±Ù‚Ù… Ø§Ù„Ù…ÙˆÙ‚Ù ØºÙŠØ± ØµØ­ÙŠØ­');
                return;
            }
            
            const bus = busRecords.find(b => 
                b.forms?.ScrWelcomeLounge && 
                parseInt(b.forms.ScrWelcomeLounge.ParkNO) === from
            );
            
            if (!bus) return;
            
            // Check if target is occupied
            const targetBus = busRecords.find(b => 
                b.forms?.ScrWelcomeLounge && 
                parseInt(b.forms.ScrWelcomeLounge.ParkNO) === to
            );
            
            if (targetBus) {
                if (!confirm(`Ø§Ù„Ù…ÙˆÙ‚Ù ${to} Ù…Ø´ØºÙˆÙ„. Ù‡Ù„ ØªØ±ÙŠØ¯ Ø§Ù„ØªØ¨Ø¯ÙŠÙ„ØŸ`)) return;
                targetBus.forms.ScrWelcomeLounge.ParkNO = from.toString();
            }
            
            bus.forms.ScrWelcomeLounge.ParkNO = to.toString();
            selectedSpot = to;
            
            closeModal('moveModal');
            save();
            render();
            
            showNotification('success', 'ØªÙ… Ø§Ù„Ù†Ù‚Ù„', `ØªÙ… Ù†Ù‚Ù„ Ø§Ù„Ø­Ø§ÙÙ„Ø© Ù…Ù† ${from} Ø¥Ù„Ù‰ ${to}`);
        }

        function deleteFromSpot() {
            if (!selectedSpot) return;
            if (!confirm(`Ø¥Ø®Ù„Ø§Ø¡ Ø§Ù„Ù…ÙˆÙ‚Ù Ø±Ù‚Ù… ${selectedSpot}ØŸ`)) return;
            
            const bus = busRecords.find(b => 
                b.forms?.ScrWelcomeLounge && 
                parseInt(b.forms.ScrWelcomeLounge.ParkNO) === selectedSpot
            );
            
            if (bus && bus.forms.ScrWelcomeLounge) {
                bus.forms.ScrWelcomeLounge.ParkNO = '';
            }
            
            selectedSpot = null;
            document.getElementById('selectedActions').style.display = 'none';
            save();
            render();
            
            showNotification('info', 'ØªÙ… Ø§Ù„Ø¥Ø®Ù„Ø§Ø¡', 'ØªÙ… Ø¥Ø®Ù„Ø§Ø¡ Ø§Ù„Ù…ÙˆÙ‚Ù');
        }

        // â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
        // TOOLTIP
        // â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
        
        function showTooltip(e, bus, info, num) {
            const t = document.getElementById('tooltip');
            t.style.display = 'block';
            const colors = { early: 'var(--green)', ontime: 'var(--blue)', late: 'var(--red)' };
            const welcomeData = bus.forms?.ScrWelcomeLounge || {};
            
            t.innerHTML = `
                <div class="tooltip-title">ğŸšŒ Ù…ÙˆÙ‚Ù #${num}</div>
                <div class="tooltip-line"><b>Ø§Ù„Ù„ÙˆØ­Ø©:</b> ${bus.BusPlate}</div>
                <div class="tooltip-line"><b>Ø§Ù„Ø±Ø­Ù„Ø©:</b> ${bus.FlightNo || '-'}</div>
                <div class="tooltip-line"><b>Ø§Ù„Ø±ÙƒØ§Ø¨:</b> ${bus.PaxCount || bus.TotalPax || '-'}</div>
                <div class="tooltip-line"><b>Ø§Ù„Ø¨ÙˆØ§Ø¨Ø©:</b> ${welcomeData.GetaNO || '-'}</div>
                <div class="tooltip-line"><b>Ø§Ù„Ù…Ø¨Ù†Ù‰:</b> ${bus.TerminalCd || '-'}</div>
                <div class="tooltip-line"><b>Ø§Ù„ØªØ£Ø´ÙŠØ±Ø©:</b> ${bus.VisaType || '-'}</div>
                <div class="tooltip-line"><b>Ø§Ù„ÙˆÙ‚Øª Ø§Ù„Ù…ØªØ¨Ù‚ÙŠ:</b> ${formatCountdown(info.diffMinutes)}</div>
                <div class="tooltip-line" style="color:${colors[info.status]}"><b>Ø§Ù„Ø­Ø§Ù„Ø©:</b> ${info.label}</div>
            `;
            moveTooltip(e);
        }
        
        function moveTooltip(e) {
            const t = document.getElementById('tooltip');
            t.style.left = (e.pageX + 15) + 'px';
            t.style.top = (e.pageY + 15) + 'px';
        }
        
        function hideTooltip() {
            document.getElementById('tooltip').style.display = 'none';
        }

        // â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
        // PANEL & UI
        // â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
        
        function togglePanel() {
            panelVisible = !panelVisible;
            document.getElementById('controlPanel').classList.toggle('hidden', !panelVisible);
            document.getElementById('toggleBtn').classList.toggle('panel-visible', panelVisible);
            ['header', 'dailyStats', 'statsBar', 'mainContainer'].forEach(id => {
                document.getElementById(id).classList.toggle('panel-open', panelVisible);
            });
        }

        function switchTab(tab) {
            document.querySelectorAll('.panel-tab').forEach(t => t.classList.remove('active'));
            document.querySelectorAll('.tab-content').forEach(c => c.classList.remove('active'));
            event.target.closest('.panel-tab').classList.add('active');
            document.getElementById('tab-' + tab).classList.add('active');
        }

        function closeModal(id) {
            document.getElementById(id).classList.remove('active');
        }

        function toggleFullscreen() {
            if (!document.fullscreenElement) {
                document.documentElement.requestFullscreen();
            } else {
                document.exitFullscreen();
            }
        }

        // â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
        // ZOOM
        // â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
        
        function setZoom(val) {
            zoomLevel = parseInt(val);
            document.getElementById('zoomValue').textContent = zoomLevel;
            document.getElementById('parkingWrapper').style.transform = `scale(${zoomLevel/100})`;
            document.getElementById('parkingWrapper').style.transformOrigin = 'top center';
        }
        function zoomIn() { setZoom(Math.min(zoomLevel + 10, 150)); }
        function zoomOut() { setZoom(Math.max(zoomLevel - 10, 50)); }
        function zoomReset() { setZoom(100); }

        // â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
        // FILTER
        // â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
        
        function filterByStatus(status) {
            currentFilter = status;
            render();
        }

        // â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
        // SETTINGS
        // â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
        
        function updateThresholds() {
            config.thresholds.early = parseInt(document.getElementById('earlyThreshold').value) || 7;
            config.thresholds.late = parseInt(document.getElementById('lateThreshold').value) || 3;
            render();
            showNotification('info', 'ØªÙ… Ø§Ù„ØªØ­Ø¯ÙŠØ«', 'ØªÙ… ØªØ­Ø¯ÙŠØ« Ø­Ø¯ÙˆØ¯ Ø§Ù„ØªÙÙˆÙŠØ¬');
        }

        function saveSettings() {
            config.sound = document.getElementById('soundEnabled').checked;
            config.notify = document.getElementById('notifyEnabled').checked;
            localStorage.setItem('LOCC_Config', JSON.stringify(config));
            showNotification('success', 'ØªÙ… Ø§Ù„Ø­ÙØ¸', 'ØªÙ… Ø­ÙØ¸ Ø§Ù„Ø¥Ø¹Ø¯Ø§Ø¯Ø§Øª');
        }

        function resetSettings() {
            config = { thresholds: { early: 7, late: 3 }, sound: true, notify: true };
            document.getElementById('earlyThreshold').value = 7;
            document.getElementById('lateThreshold').value = 3;
            document.getElementById('soundEnabled').checked = true;
            document.getElementById('notifyEnabled').checked = true;
            localStorage.removeItem('LOCC_Config');
            render();
            showNotification('info', 'ØªÙ… Ø¥Ø¹Ø§Ø¯Ø© Ø§Ù„ØªØ¹ÙŠÙŠÙ†', 'ØªÙ… Ø¥Ø¹Ø§Ø¯Ø© Ø§Ù„Ø¥Ø¹Ø¯Ø§Ø¯Ø§Øª Ù„Ù„ÙˆØ¶Ø¹ Ø§Ù„Ø§ÙØªØ±Ø§Ø¶ÙŠ');
        }

        // â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
        // DATA MANAGEMENT
        // â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
        
        function save() {
            localStorage.setItem('LOCC_Data', JSON.stringify(busRecords));
        }

        function load() {
            const data = localStorage.getItem('LOCC_Data');
            if (data) {
                busRecords = JSON.parse(data);
                return true;
            }
            return false;
        }

        function exportJSON() {
            const data = JSON.stringify(busRecords, null, 2);
            download(data, 'LOCC_Export.json', 'application/json');
            showNotification('success', 'ØªÙ… Ø§Ù„ØªØµØ¯ÙŠØ±', 'ØªÙ… ØªØµØ¯ÙŠØ± Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª Ø¨ØµÙŠØºØ© JSON');
        }

        function exportCSV() {
            let csv = 'BusPlate,FlightNo,PaxCount,ParkNO,TerminalCd,VisaType,GetaNO,DepDate,DepHour\n';
            busRecords.forEach(b => {
                const w = b.forms?.ScrWelcomeLounge || {};
                csv += `${b.BusPlate},${b.FlightNo || ''},${b.PaxCount || ''},${w.ParkNO || ''},${b.TerminalCd || ''},${b.VisaType || ''},${w.GetaNO || ''},${b.DepDate || ''},${b.DepHour || ''}\n`;
            });
            download(csv, 'LOCC_Export.csv', 'text/csv');
            showNotification('success', 'ØªÙ… Ø§Ù„ØªØµØ¯ÙŠØ±', 'ØªÙ… ØªØµØ¯ÙŠØ± Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª Ø¨ØµÙŠØºØ© CSV');
        }

        function download(data, filename, type) {
            const blob = new Blob([data], { type });
            const url = URL.createObjectURL(blob);
            const a = document.createElement('a');
            a.href = url;
            a.download = filename;
            a.click();
        }

        function importJSON(e) {
            const file = e.target.files[0];
            if (!file) return;
            const reader = new FileReader();
            reader.onload = function(ev) {
                try {
                    busRecords = JSON.parse(ev.target.result);
                    save();
                    render();
                    renderBusList();
                    showNotification('success', 'ØªÙ… Ø§Ù„Ø§Ø³ØªÙŠØ±Ø§Ø¯', `ØªÙ… Ø§Ø³ØªÙŠØ±Ø§Ø¯ ${busRecords.length} Ø­Ø§ÙÙ„Ø©`);
                } catch {
                    showNotification('error', 'Ø®Ø·Ø£', 'ÙØ´Ù„ ÙÙŠ Ù‚Ø±Ø§Ø¡Ø© Ø§Ù„Ù…Ù„Ù');
                }
            };
            reader.readAsText(file);
        }

        function resetAll() {
            if (!confirm('âš ï¸ Ù‡Ù„ Ø£Ù†Øª Ù…ØªØ£ÙƒØ¯ Ù…Ù† Ø­Ø°Ù Ø¬Ù…ÙŠØ¹ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§ØªØŸ')) return;
            busRecords = [];
            alerts = [];
            selectedSpot = null;
            document.getElementById('selectedActions').style.display = 'none';
            localStorage.removeItem('LOCC_Data');
            render();
            renderBusList();
            renderAlerts();
            showNotification('warning', 'ØªÙ… Ø§Ù„Ù…Ø³Ø­', 'ØªÙ… Ù…Ø³Ø­ Ø¬Ù…ÙŠØ¹ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª');
        }

        // â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
        // TIME UPDATE
        // â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
        
        function updateTime() {
            const now = new Date();
            document.getElementById('timeDisplay').textContent = now.toLocaleTimeString('ar-SA', { hour12: false });
            document.getElementById('dateDisplay').textContent = now.toLocaleDateString('ar-SA');
            const h = now.getHours();
            const shift = h >= 6 && h < 14 ? 'A' : h >= 14 && h < 22 ? 'B' : 'C';
            document.getElementById('shiftDisplay').textContent = 'Ù†ÙˆØ¨Ø© ' + shift;
        }

        // â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
        // INIT
        // â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
        
        function init() {
            // Load saved config
            const savedConfig = localStorage.getItem('LOCC_Config');
            if (savedConfig) {
                config = { ...config, ...JSON.parse(savedConfig) };
                document.getElementById('earlyThreshold').value = config.thresholds.early;
                document.getElementById('lateThreshold').value = config.thresholds.late;
            }
            
            // Load data
            load();
            
            // Initial render
            render();
            renderBusList();
            renderAlerts();
            updateTime();
            
            // Update intervals
            setInterval(updateTime, 1000);
            setInterval(updateCountdowns, 1000);
            setInterval(save, 30000);
            setInterval(() => { render(); }, 60000); // Refresh every minute
            
            // Welcome notification
            showNotification('info', 'Ù…Ø±Ø­Ø¨Ø§Ù‹', 'Ù†Ø¸Ø§Ù… Ø¥Ø¯Ø§Ø±Ø© Ø¹Ù…Ù„ÙŠØ§Øª Ø§Ù„Ø³Ø§Ø­Ø§Øª Ø¬Ø§Ù‡Ø² Ù„Ù„Ø¹Ù…Ù„');
        }

        // Keyboard shortcuts
        document.addEventListener('keydown', e => {
            if (e.ctrlKey && e.key === 's') { e.preventDefault(); exportJSON(); }
            if (e.key === 'Escape') {
                closeModal('formModal');
                closeModal('moveModal');
                closeModal('detailsModal');
            }
            if (e.key === 'F11') { e.preventDefault(); toggleFullscreen(); }
        });

        // Initialize
        init();
    </script>
</body>
</html>
