<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Ø¥Ø¯Ø§Ø±Ø© Ø¹Ù…Ù„ÙŠØ§Øª Ø§Ù„Ø³Ø§Ø­Ø§Øª Ø§Ù„Ø®Ø§Ø±Ø¬ÙŠØ© ÙˆØ§Ù„Ù…ÙˆØ§ØµÙ„Ø§Øª</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        :root {
            --primary: #ffd700;
            --bg-dark: #0a0a0a;
            --bg-card: #1a1a1a;
            --bg-input: #2a2a2a;
            --green: #4caf50;
            --blue: #2196f3;
            --red: #f44336;
            --orange: #ff9800;
            --text: #fff;
            --text-muted: #888;
        }

        html, body {
            height: 100%;
            overflow: hidden;
        }

        body {
            font-family: 'Segoe UI', Tahoma, Arial, sans-serif;
            background: var(--bg-dark);
            color: var(--text);
            display: flex;
            flex-direction: column;
        }

        ::-webkit-scrollbar { width: 8px; height: 8px; }
        ::-webkit-scrollbar-track { background: var(--bg-dark); }
        ::-webkit-scrollbar-thumb { background: var(--primary); border-radius: 4px; }

        /* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• NOTIFICATIONS â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
        .notifications-container {
            position: fixed;
            top: 80px;
            left: 20px;
            z-index: 3000;
            display: flex;
            flex-direction: column;
            gap: 10px;
            max-width: 400px;
            max-height: 70vh;
            overflow-y: auto;
        }
        .notification {
            padding: 15px 20px;
            border-radius: 10px;
            display: flex;
            align-items: center;
            gap: 12px;
            animation: slideIn 0.4s ease;
            box-shadow: 0 8px 30px rgba(0,0,0,0.6);
            cursor: pointer;
            backdrop-filter: blur(10px);
        }
        .notification.success { background: linear-gradient(135deg, rgba(27,94,32,0.95), rgba(46,125,50,0.95)); border-right: 4px solid #4caf50; }
        .notification.warning { background: linear-gradient(135deg, rgba(230,81,0,0.95), rgba(245,124,0,0.95)); border-right: 4px solid #ff9800; }
        .notification.error { background: linear-gradient(135deg, rgba(183,28,28,0.95), rgba(211,47,47,0.95)); border-right: 4px solid #f44336; }
        .notification.info { background: linear-gradient(135deg, rgba(13,71,161,0.95), rgba(25,118,210,0.95)); border-right: 4px solid #2196f3; }
        .notification-icon { font-size: 1.5rem; }
        .notification-content { flex: 1; }
        .notification-title { font-weight: bold; margin-bottom: 3px; }
        .notification-message { font-size: 0.85rem; opacity: 0.9; }
        .notification-close { cursor: pointer; opacity: 0.7; font-size: 1.3rem; }
        @keyframes slideIn { from { transform: translateX(-100%); opacity: 0; } to { transform: translateX(0); opacity: 1; } }

        /* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• HEADER â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
        .header {
            background: linear-gradient(180deg, var(--bg-card) 0%, var(--bg-dark) 100%);
            padding: 15px 30px;
            border-bottom: 3px solid var(--primary);
            box-shadow: 0 4px 20px rgba(255, 215, 0, 0.3);
            flex-shrink: 0;
        }
        .header-content {
            display: flex;
            justify-content: space-between;
            align-items: center;
            flex-wrap: wrap;
            gap: 15px;
        }
        .header-title {
            font-size: clamp(1.2rem, 3vw, 2rem);
            font-weight: 700;
            color: var(--primary);
            text-shadow: 0 0 20px rgba(255, 215, 0, 0.5);
        }
        .header-info {
            display: flex;
            gap: 20px;
            flex-wrap: wrap;
        }
        .info-box {
            background: rgba(255, 215, 0, 0.1);
            border: 2px solid var(--primary);
            padding: 8px 16px;
            border-radius: 8px;
            text-align: center;
            min-width: 120px;
        }
        .info-label { font-size: 0.7rem; color: var(--primary); margin-bottom: 3px; }
        .info-value { font-size: 1.1rem; font-weight: 600; }
        .header-controls {
            display: flex;
            gap: 10px;
        }
        .header-btn {
            background: rgba(255, 215, 0, 0.1);
            border: 2px solid var(--primary);
            color: var(--primary);
            padding: 8px 15px;
            border-radius: 8px;
            cursor: pointer;
            font-size: 0.85rem;
            transition: all 0.3s;
        }
        .header-btn:hover { background: var(--primary); color: #000; }
        .header-btn.active { background: var(--primary); color: #000; }

        /* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• MAIN LAYOUT â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
        .main-container {
            display: flex;
            flex: 1;
            overflow: hidden;
        }

        /* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• SIDEBAR â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
        .sidebar {
            width: 360px;
            background: var(--bg-card);
            display: flex;
            flex-direction: column;
            border-left: 3px solid var(--primary);
            flex-shrink: 0;
            transition: all 0.3s;
        }
        .sidebar.hidden {
            width: 0;
            border: none;
            overflow: hidden;
        }
        .sidebar-tabs {
            display: flex;
            flex-wrap: wrap;
            background: var(--bg-dark);
            border-bottom: 2px solid var(--primary);
        }
        .sidebar-tab {
            flex: 1;
            min-width: 33.33%;
            padding: 12px 8px;
            background: transparent;
            border: none;
            color: var(--text-muted);
            cursor: pointer;
            font-size: 0.75rem;
            transition: all 0.3s;
            display: flex;
            flex-direction: column;
            align-items: center;
            gap: 4px;
        }
        .sidebar-tab:hover { background: var(--bg-input); color: var(--text); }
        .sidebar-tab.active { background: var(--bg-card); color: var(--primary); border-bottom: 3px solid var(--primary); }
        .sidebar-tab span { font-size: 1.3rem; }
        .sidebar-content {
            flex: 1;
            overflow-y: auto;
            padding: 15px;
        }
        .tab-panel { display: none; }
        .tab-panel.active { display: block; }

        /* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• STATISTICS BAR â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
        .stats-bar {
            background: var(--bg-card);
            padding: 15px 20px;
            border-bottom: 2px solid var(--primary);
            display: flex;
            justify-content: space-around;
            gap: 15px;
            flex-wrap: wrap;
            flex-shrink: 0;
        }
        .stat-card {
            background: rgba(255, 215, 0, 0.05);
            border: 2px solid var(--primary);
            border-radius: 10px;
            padding: 12px 20px;
            flex: 1;
            min-width: 120px;
            max-width: 180px;
            text-align: center;
            transition: all 0.3s;
            position: relative;
            overflow: hidden;
        }
        .stat-card::before {
            content: '';
            position: absolute;
            top: -50%;
            left: -50%;
            width: 200%;
            height: 200%;
            background: linear-gradient(45deg, transparent, rgba(255, 215, 0, 0.1), transparent);
            transform: rotate(45deg);
            animation: shimmer 3s infinite;
        }
        @keyframes shimmer {
            0% { transform: translateX(-100%) translateY(-100%) rotate(45deg); }
            100% { transform: translateX(100%) translateY(100%) rotate(45deg); }
        }
        .stat-card:hover {
            transform: translateY(-3px);
            box-shadow: 0 8px 25px rgba(255, 215, 0, 0.3);
        }
        .stat-icon { font-size: 1.5rem; margin-bottom: 5px; }
        .stat-value {
            font-size: clamp(1.5rem, 3vw, 2.2rem);
            font-weight: 700;
            color: var(--primary);
            text-shadow: 0 0 10px rgba(255, 215, 0, 0.5);
        }
        .stat-label { font-size: 0.75rem; color: #ccc; margin-top: 3px; }

        /* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• LEGEND â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
        .legend {
            display: flex;
            justify-content: center;
            gap: 30px;
            padding: 12px 20px;
            background: rgba(255, 215, 0, 0.05);
            border-bottom: 2px solid var(--primary);
            flex-wrap: wrap;
            flex-shrink: 0;
        }
        .legend-item {
            display: flex;
            align-items: center;
            gap: 10px;
        }
        .legend-color {
            width: 30px;
            height: 30px;
            border-radius: 6px;
            border: 2px solid var(--primary);
        }
        .legend-color.early { background: linear-gradient(135deg, #1b5e20, #2e7d32); }
        .legend-color.ontime { background: linear-gradient(135deg, #0d47a1, #1565c0); }
        .legend-color.late { background: linear-gradient(135deg, #b71c1c, #c62828); }
        .legend-color.empty { background: #1a1a1a; }
        .legend-text { font-size: 0.9rem; font-weight: 600; }

        /* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• PARKING AREA â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
        .parking-area {
            flex: 1;
            display: flex;
            flex-direction: column;
            overflow: hidden;
        }
        .parking-container {
            flex: 1;
            padding: 20px;
            overflow-y: auto;
        }
        .section-title {
            text-align: center;
            font-size: clamp(1rem, 2vw, 1.5rem);
            color: var(--primary);
            margin-bottom: 20px;
            text-transform: uppercase;
            letter-spacing: 2px;
            text-shadow: 0 0 20px rgba(255, 215, 0, 0.5);
        }
        .parking-grid {
            display: flex;
            gap: 40px;
            justify-content: center;
            flex-wrap: wrap;
        }
        .parking-section {
            flex: 1;
            min-width: 300px;
            max-width: 800px;
        }
        .section-label {
            text-align: center;
            font-size: 1.1rem;
            color: var(--primary);
            margin-bottom: 15px;
            font-weight: 700;
            padding: 10px;
            background: rgba(255, 215, 0, 0.1);
            border: 2px solid var(--primary);
            border-radius: 8px;
        }
        .parking-row {
            display: flex;
            gap: 10px;
            margin-bottom: 15px;
            justify-content: center;
            flex-wrap: wrap;
        }

        /* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• PARKING SPOTS â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
        .parking-spot {
            width: clamp(80px, 10vw, 140px);
            height: clamp(120px, 15vw, 200px);
            background: #2a2a2a;
            border: 3px solid var(--primary);
            border-radius: 8px;
            padding: 8px;
            position: relative;
            cursor: pointer;
            transition: all 0.3s;
            display: flex;
            flex-direction: column;
            justify-content: space-between;
        }
        .parking-spot:hover {
            transform: scale(1.08);
            box-shadow: 0 0 30px rgba(255, 215, 0, 0.6);
            z-index: 10;
        }
        .parking-spot.early {
            background: linear-gradient(135deg, #1b5e20 0%, #2e7d32 100%);
            border-color: #4caf50;
            box-shadow: 0 0 20px rgba(76, 175, 80, 0.4);
        }
        .parking-spot.ontime {
            background: linear-gradient(135deg, #0d47a1 0%, #1565c0 100%);
            border-color: #2196f3;
            box-shadow: 0 0 20px rgba(33, 150, 243, 0.4);
        }
        .parking-spot.late {
            background: linear-gradient(135deg, #b71c1c 0%, #c62828 100%);
            border-color: #f44336;
            box-shadow: 0 0 20px rgba(244, 67, 54, 0.4);
            animation: pulse-red 0.8s infinite;
        }
        @keyframes pulse-red {
            0%, 100% { 
                box-shadow: 0 0 20px rgba(244, 67, 54, 0.4);
                transform: scale(1);
            }
            50% { 
                box-shadow: 0 0 50px rgba(244, 67, 54, 1);
                transform: scale(1.02);
            }
        }
        .parking-spot.empty {
            background: #1a1a1a;
            border-color: #555;
            opacity: 0.6;
        }
        .parking-spot.empty:hover { opacity: 0.9; }
        .spot-number {
            position: absolute;
            top: 3px;
            right: 5px;
            background: rgba(0, 0, 0, 0.7);
            color: var(--primary);
            padding: 2px 6px;
            border-radius: 4px;
            font-size: clamp(0.6rem, 1vw, 0.8rem);
            font-weight: 700;
        }
        .spot-status-badge {
            position: absolute;
            top: 3px;
            left: 3px;
            padding: 2px 6px;
            border-radius: 4px;
            font-size: clamp(0.5rem, 0.8vw, 0.65rem);
            font-weight: 700;
        }
        .spot-status-badge.early { background: #4caf50; }
        .spot-status-badge.ontime { background: #2196f3; }
        .spot-status-badge.late { background: #f44336; }
        .bus-info {
            flex: 1;
            display: flex;
            flex-direction: column;
            justify-content: center;
            gap: 4px;
            margin-top: 20px;
        }
        .info-line {
            display: flex;
            align-items: center;
            gap: 4px;
            font-size: clamp(0.55rem, 0.9vw, 0.75rem);
            color: #fff;
        }
        .info-icon { font-size: clamp(0.7rem, 1vw, 0.9rem); min-width: 14px; }
        .info-text {
            flex: 1;
            overflow: hidden;
            text-overflow: ellipsis;
            white-space: nowrap;
            font-weight: 600;
        }
        .time-diff {
            text-align: center;
            font-size: clamp(0.6rem, 1vw, 0.85rem);
            font-weight: 700;
            padding: 4px;
            background: rgba(0, 0, 0, 0.4);
            border-radius: 4px;
        }
        .countdown {
            font-size: clamp(0.7rem, 1.2vw, 1rem);
            font-weight: bold;
            color: var(--primary);
        }
        .empty-text {
            text-align: center;
            color: #666;
            font-size: 2rem;
            margin-top: 40%;
        }

        /* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• FORM MENU â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
        .form-menu {
            position: fixed;
            background: var(--bg-card);
            border: 2px solid var(--primary);
            border-radius: 10px;
            padding: 10px 0;
            z-index: 2000;
            min-width: 220px;
            box-shadow: 0 10px 40px rgba(0,0,0,0.7);
            display: none;
        }
        .form-menu.show { display: block; }
        .form-menu-title {
            padding: 10px 15px;
            color: var(--primary);
            font-weight: bold;
            border-bottom: 1px solid #333;
            margin-bottom: 5px;
        }
        .form-menu-item {
            padding: 12px 15px;
            cursor: pointer;
            transition: all 0.2s;
            display: flex;
            align-items: center;
            gap: 10px;
        }
        .form-menu-item:hover { background: var(--bg-input); color: var(--primary); }
        .form-menu-item span { font-size: 1.3rem; }

        /* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• MODAL â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
        .modal-overlay {
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: rgba(0,0,0,0.9);
            z-index: 2500;
            display: none;
            align-items: center;
            justify-content: center;
            backdrop-filter: blur(5px);
        }
        .modal-overlay.show { display: flex; }
        .modal {
            background: var(--bg-card);
            border-radius: 15px;
            width: 95%;
            max-width: 650px;
            max-height: 90vh;
            overflow: hidden;
            border: 3px solid var(--primary);
            box-shadow: 0 20px 60px rgba(255,215,0,0.3);
        }
        .modal-header {
            background: linear-gradient(135deg, var(--bg-input), #333);
            padding: 18px 25px;
            display: flex;
            justify-content: space-between;
            align-items: center;
            border-bottom: 2px solid var(--primary);
        }
        .modal-title { font-size: 1.2rem; color: var(--primary); font-weight: bold; }
        .modal-close {
            background: none;
            border: none;
            color: var(--text);
            font-size: 1.8rem;
            cursor: pointer;
            transition: color 0.3s;
        }
        .modal-close:hover { color: var(--red); }
        .modal-body {
            padding: 25px;
            overflow-y: auto;
            max-height: calc(90vh - 150px);
        }
        .modal-footer {
            padding: 18px 25px;
            border-top: 1px solid #333;
            display: flex;
            gap: 12px;
            justify-content: flex-end;
        }

        /* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• FORM STYLES â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
        .form-section {
            margin-bottom: 20px;
            padding: 18px;
            background: var(--bg-input);
            border-radius: 12px;
            border: 1px solid #444;
        }
        .form-section-title {
            color: var(--primary);
            font-size: 1rem;
            margin-bottom: 15px;
            padding-bottom: 10px;
            border-bottom: 1px solid #444;
            display: flex;
            align-items: center;
            gap: 10px;
        }
        .form-row {
            display: grid;
            grid-template-columns: repeat(2, 1fr);
            gap: 15px;
            margin-bottom: 15px;
        }
        .form-group { display: flex; flex-direction: column; gap: 6px; }
        .form-group.full-width { grid-column: span 2; }
        .form-group label {
            font-size: 0.85rem;
            color: var(--text-muted);
        }
        .form-group input, .form-group select, .form-group textarea {
            padding: 12px;
            background: var(--bg-dark);
            border: 2px solid #444;
            border-radius: 8px;
            color: var(--text);
            font-size: 1rem;
            transition: border-color 0.3s;
        }
        .form-group input:focus, .form-group select:focus, .form-group textarea:focus {
            outline: none;
            border-color: var(--primary);
        }

        /* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• BUTTONS â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
        .btn {
            padding: 12px 25px;
            border: none;
            border-radius: 8px;
            cursor: pointer;
            font-size: 1rem;
            display: flex;
            align-items: center;
            gap: 8px;
            transition: all 0.3s;
            font-weight: 600;
        }
        .btn-primary { background: var(--primary); color: #000; }
        .btn-primary:hover { background: #ffed4a; transform: translateY(-2px); }
        .btn-secondary { background: var(--bg-input); color: var(--text); border: 2px solid #555; }
        .btn-secondary:hover { background: #444; }
        .btn-danger { background: var(--red); color: #fff; }
        .btn-danger:hover { background: #d32f2f; }

        /* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• SETTINGS TAB â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
        .settings-section {
            background: var(--bg-input);
            border-radius: 10px;
            padding: 15px;
            margin-bottom: 15px;
            border: 1px solid #333;
        }
        .settings-section h3 {
            color: var(--primary);
            font-size: 0.95rem;
            margin-bottom: 15px;
            display: flex;
            align-items: center;
            gap: 8px;
        }
        .setting-item {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 12px 0;
            border-bottom: 1px solid #333;
        }
        .setting-item:last-child { border-bottom: none; }
        .setting-label { font-size: 0.9rem; }
        .toggle {
            width: 50px;
            height: 26px;
            background: #444;
            border-radius: 13px;
            position: relative;
            cursor: pointer;
            transition: all 0.3s;
        }
        .toggle.active { background: var(--green); }
        .toggle::after {
            content: '';
            position: absolute;
            width: 20px;
            height: 20px;
            background: #fff;
            border-radius: 50%;
            top: 3px;
            right: 3px;
            transition: all 0.3s;
        }
        .toggle.active::after { right: 27px; }
        .color-picker {
            display: flex;
            gap: 8px;
            align-items: center;
        }
        .color-picker input[type="color"] {
            width: 40px;
            height: 30px;
            border: none;
            border-radius: 5px;
            cursor: pointer;
        }

        /* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• ALERTS TAB â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
        .alerts-list {
            max-height: 600px;
            overflow-y: auto;
        }
        .alert-item {
            padding: 12px;
            margin-bottom: 10px;
            background: var(--bg-input);
            border-radius: 8px;
            border-right: 4px solid;
            display: flex;
            gap: 12px;
        }
        .alert-item.alert-danger { border-color: var(--red); }
        .alert-item.alert-warning { border-color: var(--orange); }
        .alert-item.alert-info { border-color: var(--blue); }
        .alert-item.alert-success { border-color: var(--green); }
        .alert-icon { font-size: 1.4rem; }
        .alert-content { flex: 1; }
        .alert-title { font-weight: bold; font-size: 0.95rem; margin-bottom: 4px; }
        .alert-message { font-size: 0.85rem; color: var(--text-muted); }
        .alert-time { font-size: 0.75rem; color: var(--text-muted); margin-top: 5px; }

        /* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• KPIs TAB â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
        .kpi-card {
            background: var(--bg-input);
            border-radius: 12px;
            padding: 18px;
            margin-bottom: 15px;
            border-right: 4px solid var(--primary);
        }
        .kpi-title { font-size: 0.85rem; color: var(--text-muted); margin-bottom: 10px; }
        .kpi-value { font-size: 2rem; font-weight: bold; color: var(--primary); }
        .kpi-subtitle { font-size: 0.8rem; color: var(--text-muted); margin-top: 8px; }
        .progress-bar {
            height: 10px;
            background: var(--bg-dark);
            border-radius: 5px;
            overflow: hidden;
            margin-top: 10px;
        }
        .progress-fill {
            height: 100%;
            transition: width 0.5s;
        }
        .progress-fill.green { background: var(--green); }
        .progress-fill.blue { background: var(--blue); }
        .progress-fill.red { background: var(--red); }
        .kpi-chart {
            height: 25px;
            border-radius: 5px;
            margin-top: 12px;
        }

        /* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• FORMS TAB â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
        .form-card {
            background: var(--bg-input);
            border-radius: 10px;
            padding: 15px;
            margin-bottom: 12px;
            cursor: pointer;
            transition: all 0.3s;
            border: 2px solid transparent;
        }
        .form-card:hover { border-color: var(--primary); transform: translateX(-5px); }
        .form-card-header {
            display: flex;
            align-items: center;
            gap: 12px;
            margin-bottom: 8px;
        }
        .form-card-icon { font-size: 1.8rem; }
        .form-card-title { font-weight: bold; font-size: 1rem; }
        .form-card-desc { font-size: 0.85rem; color: var(--text-muted); }

        /* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• REGISTERED BUSES TAB â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
        .bus-record {
            background: var(--bg-input);
            border-radius: 12px;
            padding: 15px;
            margin-bottom: 12px;
            border-right: 4px solid var(--primary);
            cursor: pointer;
            transition: all 0.3s;
        }
        .bus-record:hover { transform: translateX(-5px); border-color: #fff; }
        .bus-record-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 12px;
        }
        .bus-record-plate {
            font-weight: bold;
            font-size: 1.15rem;
            color: var(--primary);
        }
        .bus-record-spot {
            background: var(--bg-dark);
            padding: 5px 12px;
            border-radius: 6px;
            font-size: 0.85rem;
        }
        .bus-record-info {
            display: flex;
            gap: 15px;
            font-size: 0.85rem;
            color: var(--text-muted);
            margin-bottom: 10px;
        }
        .form-progress {
            height: 8px;
            background: var(--bg-dark);
            border-radius: 4px;
            overflow: hidden;
            margin-bottom: 10px;
        }
        .form-progress-fill {
            height: 100%;
            background: var(--green);
            transition: width 0.3s;
        }
        .bus-record-forms {
            display: flex;
            flex-wrap: wrap;
            gap: 6px;
        }
        .form-badge {
            padding: 4px 10px;
            border-radius: 5px;
            font-size: 0.75rem;
            background: var(--bg-dark);
            color: var(--text-muted);
        }
        .form-badge.completed { background: var(--green); color: #fff; }
        .form-badge.in-progress { background: var(--orange); color: #fff; }

        /* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• TOOLTIP â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
        .tooltip {
            position: fixed;
            background: rgba(0, 0, 0, 0.95);
            border: 2px solid var(--primary);
            padding: 15px;
            border-radius: 10px;
            pointer-events: none;
            z-index: 1000;
            display: none;
            min-width: 280px;
            box-shadow: 0 10px 30px rgba(255, 215, 0, 0.3);
        }
        .tooltip-title {
            font-size: 1rem;
            font-weight: 700;
            color: var(--primary);
            margin-bottom: 10px;
            border-bottom: 1px solid var(--primary);
            padding-bottom: 8px;
        }
        .tooltip-line {
            font-size: 0.9rem;
            margin: 6px 0;
            color: #fff;
        }

        /* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• FOOTER â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
        .footer {
            background: var(--bg-card);
            padding: 12px 20px;
            text-align: center;
            border-top: 3px solid var(--primary);
            flex-shrink: 0;
        }
        .footer-text {
            color: var(--primary);
            font-size: 0.85rem;
            letter-spacing: 1px;
        }

        /* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• RESPONSIVE â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
        @media (max-width: 1200px) {
            .sidebar { width: 320px; }
            .parking-grid { gap: 20px; }
        }
        @media (max-width: 900px) {
            .sidebar { width: 280px; }
            .stats-bar { padding: 10px; }
            .stat-card { padding: 10px 15px; min-width: 100px; }
        }
        @media (max-width: 768px) {
            .main-container { flex-direction: column; }
            .sidebar { width: 100%; height: 50%; border-left: none; border-top: 3px solid var(--primary); }
            .parking-grid { flex-direction: column; }
        }
    </style>
</head>
<body>
    <!-- Notifications Container -->
    <div class="notifications-container" id="notificationsContainer"></div>

    <!-- Form Selection Menu -->
    <div class="form-menu" id="formMenu">
        <div class="form-menu-title">ğŸ“‹ Ø§Ø®ØªØ± Ø§Ù„Ù†Ù…ÙˆØ°Ø¬</div>
        <div class="form-menu-item" onclick="selectForm('ScrLogIn')">
            <span>ğŸšŒ</span> ScrLogIn - ØªØ³Ø¬ÙŠÙ„ Ø§Ù„Ø¯Ø®ÙˆÙ„
        </div>
        <div class="form-menu-item" onclick="selectForm('ScrSegregationIn')">
            <span>ğŸ“¥</span> ScrSegregationIn - Ø¯Ø®ÙˆÙ„ Ø§Ù„ÙØ±Ø²
        </div>
        <div class="form-menu-item" onclick="selectForm('ScrWelcomeLounge')">
            <span>â˜•</span> ScrWelcomeLounge - ØµØ§Ù„Ø© Ø§Ù„ØªØ±Ø­ÙŠØ¨
        </div>
        <div class="form-menu-item" onclick="selectForm('ScrSegregationExit')">
            <span>ğŸ“¤</span> ScrSegregationExit - Ø®Ø±ÙˆØ¬ Ø§Ù„ÙØ±Ø²
        </div>
        <div class="form-menu-item" onclick="selectForm('ScrCurbside')">
            <span>ğŸ›‘</span> ScrCurbside - Ù†Ù‚Ø·Ø© Ø§Ù„Ø¥Ù†Ø²Ø§Ù„
        </div>
    </div>

    <!-- Header -->
    <header class="header">
        <div class="header-content">
            <div class="header-title">ğŸ“º Ø¥Ø¯Ø§Ø±Ø© Ø¹Ù…Ù„ÙŠØ§Øª Ø§Ù„Ø³Ø§Ø­Ø§Øª Ø§Ù„Ø®Ø§Ø±Ø¬ÙŠØ© ÙˆØ§Ù„Ù…ÙˆØ§ØµÙ„Ø§Øª</div>
            <div class="header-info">
                <div class="info-box">
                    <div class="info-label">Ø§Ù„ÙˆÙ‚Øª Ø§Ù„Ø­Ø§Ù„ÙŠ</div>
                    <div class="info-value" id="currentTime">--:--:--</div>
                </div>
                <div class="info-box">
                    <div class="info-label">Ø§Ù„Ù†ÙˆØ¨Ø©</div>
                    <div class="info-value" id="currentShift">-</div>
                </div>
                <div class="info-box">
                    <div class="info-label">Ø§Ù„ØªØ§Ø±ÙŠØ®</div>
                    <div class="info-value" id="currentDate">----/--/--</div>
                </div>
            </div>
            <div class="header-controls">
                <button class="header-btn" onclick="toggleSidebar()" id="sidebarToggle">ğŸ“‹ Ø§Ù„Ù‚Ø§Ø¦Ù…Ø©</button>
                <button class="header-btn" onclick="toggleEditMode()" id="editToggle">âœï¸ ØªØ­Ø±ÙŠØ±</button>
            </div>
        </div>
    </header>

    <!-- Statistics Bar -->
    <div class="stats-bar">
        <div class="stat-card">
            <div class="stat-icon">ğŸšŒ</div>
            <div class="stat-value" id="totalBuses">0</div>
            <div class="stat-label">Ø¥Ø¬Ù…Ø§Ù„ÙŠ Ø§Ù„Ø­Ø§ÙÙ„Ø§Øª</div>
        </div>
        <div class="stat-card">
            <div class="stat-icon">ğŸŸ¢</div>
            <div class="stat-value" id="earlyCount">0</div>
            <div class="stat-label">Ù…Ø¨ÙƒØ± (&gt;7 Ø³Ø§Ø¹Ø§Øª)</div>
        </div>
        <div class="stat-card">
            <div class="stat-icon">ğŸ”µ</div>
            <div class="stat-value" id="ontimeCount">0</div>
            <div class="stat-label">ÙÙŠ Ø§Ù„Ù…ÙˆØ¹Ø¯ (3-7 Ø³Ø§Ø¹Ø§Øª)</div>
        </div>
        <div class="stat-card">
            <div class="stat-icon">ğŸ”´</div>
            <div class="stat-value" id="lateCount">0</div>
            <div class="stat-label">Ù…ØªØ£Ø®Ø± (&lt;3 Ø³Ø§Ø¹Ø§Øª)</div>
        </div>
        <div class="stat-card">
            <div class="stat-icon">ğŸ‘¥</div>
            <div class="stat-value" id="totalPassengers">0</div>
            <div class="stat-label">Ø§Ù„Ù…Ø³Ø§ÙØ±ÙŠÙ† Ø§Ù„ÙŠÙˆÙ…</div>
        </div>
        <div class="stat-card">
            <div class="stat-icon">âœˆï¸</div>
            <div class="stat-value" id="totalFlights">0</div>
            <div class="stat-label">Ø§Ù„Ø±Ø­Ù„Ø§Øª Ø§Ù„ÙŠÙˆÙ…</div>
        </div>
        <div class="stat-card">
            <div class="stat-icon">ğŸ“Š</div>
            <div class="stat-value" id="occupancyRate">0%</div>
            <div class="stat-label">Ù†Ø³Ø¨Ø© Ø§Ù„Ø¥Ø´ØºØ§Ù„</div>
        </div>
    </div>

    <!-- Legend -->
    <div class="legend">
        <div class="legend-item">
            <div class="legend-color early"></div>
            <div class="legend-text">ğŸŸ¢ Ù…Ø¨ÙƒØ± (&gt; 7 Ø³Ø§Ø¹Ø§Øª)</div>
        </div>
        <div class="legend-item">
            <div class="legend-color ontime"></div>
            <div class="legend-text">ğŸ”µ ÙÙŠ Ø§Ù„Ù…ÙˆØ¹Ø¯ (3-7 Ø³Ø§Ø¹Ø§Øª)</div>
        </div>
        <div class="legend-item">
            <div class="legend-color late"></div>
            <div class="legend-text">ğŸ”´ Ù…ØªØ£Ø®Ø± (&lt; 3 Ø³Ø§Ø¹Ø§Øª)</div>
        </div>
        <div class="legend-item">
            <div class="legend-color empty"></div>
            <div class="legend-text">â¬œ ÙØ§Ø±Øº</div>
        </div>
    </div>

    <!-- Main Container -->
    <div class="main-container">
        <!-- Parking Area -->
        <div class="parking-area">
            <div class="parking-container">
                <div class="section-title">â¬‡ï¸ Ù…ÙˆØ§Ù‚Ù ØµØ§Ù„Ø© Ø§Ù„ÙØ±Ø² - 87 Ù…ÙˆÙ‚Ù â¬‡ï¸</div>
                <div class="parking-grid">
                    <div class="parking-section">
                        <div class="section-label">ğŸšª Ø¬Ù‡Ø© Ø§Ù„Ù…Ø¯Ø®Ù„ (42 Ù…ÙˆÙ‚Ù)</div>
                        <div id="entranceSection"></div>
                    </div>
                    <div class="parking-section">
                        <div class="section-label">ğŸšª Ø¬Ù‡Ø© Ø§Ù„Ù…Ø®Ø±Ø¬ (45 Ù…ÙˆÙ‚Ù)</div>
                        <div id="exitSection"></div>
                    </div>
                </div>
            </div>
        </div>

        <!-- Sidebar -->
        <aside class="sidebar" id="sidebar">
            <div class="sidebar-tabs">
                <button class="sidebar-tab active" onclick="switchTab('main')">
                    <span>ğŸ </span> Ø±Ø¦ÙŠØ³ÙŠØ©
                </button>
                <button class="sidebar-tab" onclick="switchTab('settings')">
                    <span>âš™ï¸</span> Ø¥Ø¹Ø¯Ø§Ø¯Ø§Øª
                </button>
                <button class="sidebar-tab" onclick="switchTab('alerts')">
                    <span>ğŸ””</span> ØªÙ†Ø¨ÙŠÙ‡Ø§Øª
                </button>
                <button class="sidebar-tab" onclick="switchTab('kpis')">
                    <span>ğŸ“Š</span> KPIs
                </button>
                <button class="sidebar-tab" onclick="switchTab('forms')">
                    <span>ğŸ“‹</span> Ù†Ù…Ø§Ø°Ø¬
                </button>
                <button class="sidebar-tab" onclick="switchTab('buses')">
                    <span>ğŸšŒ</span> Ù…Ø³Ø¬Ù„Ø©
                </button>
            </div>

            <div class="sidebar-content">
                <!-- Main Tab -->
                <div class="tab-panel active" id="mainTab">
                    <div class="kpi-card">
                        <div class="kpi-title">Ø¥Ø¬Ù…Ø§Ù„ÙŠ Ø§Ù„Ø­Ø§ÙÙ„Ø§Øª Ø§Ù„Ø¢Ù†</div>
                        <div class="kpi-value" id="mainTotalBuses">0</div>
                    </div>
                    <div class="kpi-card" style="border-color: var(--green);">
                        <div class="kpi-title">ğŸŸ¢ Ø­Ø§ÙÙ„Ø§Øª Ù…Ø¨ÙƒØ±Ø©</div>
                        <div class="kpi-value" style="color: var(--green);" id="mainEarlyBuses">0</div>
                    </div>
                    <div class="kpi-card" style="border-color: var(--blue);">
                        <div class="kpi-title">ğŸ”µ ÙÙŠ Ø§Ù„Ù…ÙˆØ¹Ø¯</div>
                        <div class="kpi-value" style="color: var(--blue);" id="mainOnTimeBuses">0</div>
                    </div>
                    <div class="kpi-card" style="border-color: var(--red);">
                        <div class="kpi-title">ğŸ”´ Ù…ØªØ£Ø®Ø±Ø©</div>
                        <div class="kpi-value" style="color: var(--red);" id="mainLateBuses">0</div>
                    </div>
                    <div class="kpi-card">
                        <div class="kpi-title">ğŸ‘¥ Ø¥Ø¬Ù…Ø§Ù„ÙŠ Ø§Ù„Ù…Ø³Ø§ÙØ±ÙŠÙ† Ø§Ù„ÙŠÙˆÙ…</div>
                        <div class="kpi-value" id="mainTotalPax">0</div>
                    </div>
                </div>

                <!-- Settings Tab -->
                <div class="tab-panel" id="settingsTab">
                    <div class="settings-section">
                        <h3>â° Ø¥Ø¹Ø¯Ø§Ø¯Ø§Øª Ø§Ù„ÙˆÙ‚Øª</h3>
                        <div class="setting-item">
                            <span class="setting-label">Ø­Ø¯ Ø§Ù„Ù…Ø¨ÙƒØ± (Ø³Ø§Ø¹Ø§Øª)</span>
                            <input type="number" id="earlyThreshold" value="7" style="width: 70px; padding: 8px; text-align: center; background: var(--bg-dark); border: 2px solid #444; border-radius: 5px; color: #fff;">
                        </div>
                        <div class="setting-item">
                            <span class="setting-label">Ø­Ø¯ Ø§Ù„Ù…ØªØ£Ø®Ø± (Ø³Ø§Ø¹Ø§Øª)</span>
                            <input type="number" id="lateThreshold" value="3" style="width: 70px; padding: 8px; text-align: center; background: var(--bg-dark); border: 2px solid #444; border-radius: 5px; color: #fff;">
                        </div>
                    </div>
                    <div class="settings-section">
                        <h3>ğŸ¨ Ø§Ù„Ø£Ù„ÙˆØ§Ù†</h3>
                        <div class="setting-item">
                            <span class="setting-label">Ù„ÙˆÙ† Ø§Ù„Ù…Ø¨ÙƒØ±</span>
                            <div class="color-picker">
                                <input type="color" id="colorEarly" value="#4caf50" onchange="updateColors()">
                            </div>
                        </div>
                        <div class="setting-item">
                            <span class="setting-label">Ù„ÙˆÙ† ÙÙŠ Ø§Ù„Ù…ÙˆØ¹Ø¯</span>
                            <div class="color-picker">
                                <input type="color" id="colorOntime" value="#2196f3" onchange="updateColors()">
                            </div>
                        </div>
                        <div class="setting-item">
                            <span class="setting-label">Ù„ÙˆÙ† Ø§Ù„Ù…ØªØ£Ø®Ø±</span>
                            <div class="color-picker">
                                <input type="color" id="colorLate" value="#f44336" onchange="updateColors()">
                            </div>
                        </div>
                    </div>
                    <div class="settings-section">
                        <h3>ğŸ”” Ø¥Ø¹Ø¯Ø§Ø¯Ø§Øª Ø§Ù„ØªÙ†Ø¨ÙŠÙ‡Ø§Øª</h3>
                        <div class="setting-item">
                            <span class="setting-label">ØªÙ†Ø¨ÙŠÙ‡Ø§Øª ØµÙˆØªÙŠØ©</span>
                            <div class="toggle" id="soundToggle" onclick="toggleSetting('sound')"></div>
                        </div>
                        <div class="setting-item">
                            <span class="setting-label">Ø¥Ø´Ø¹Ø§Ø±Ø§Øª Ù…Ù†Ø¨Ø«Ù‚Ø©</span>
                            <div class="toggle active" id="popupToggle" onclick="toggleSetting('popup')"></div>
                        </div>
                    </div>
                    <div class="settings-section">
                        <h3>ğŸ“Š ØªØµØ¯ÙŠØ± Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª</h3>
                        <button class="btn btn-primary" onclick="exportToJSON()" style="width: 100%; margin-bottom: 10px;">
                            ğŸ“¥ ØªØµØ¯ÙŠØ± JSON
                        </button>
                        <button class="btn btn-secondary" onclick="exportToCSV()" style="width: 100%;">
                            ğŸ“¥ ØªØµØ¯ÙŠØ± CSV
                        </button>
                    </div>
                </div>

                <!-- Alerts Tab -->
                <div class="tab-panel" id="alertsTab">
                    <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 15px;">
                        <h3 style="color: var(--primary);">ğŸ“‹ Ø³Ø¬Ù„ Ø§Ù„ØªÙ†Ø¨ÙŠÙ‡Ø§Øª</h3>
                        <button class="btn btn-secondary" onclick="clearAlerts()" style="padding: 6px 12px; font-size: 0.8rem;">Ù…Ø³Ø­ Ø§Ù„ÙƒÙ„</button>
                    </div>
                    <div class="alerts-list" id="alertsList">
                        <div style="text-align: center; color: var(--text-muted); padding: 30px;">
                            Ù„Ø§ ØªÙˆØ¬Ø¯ ØªÙ†Ø¨ÙŠÙ‡Ø§Øª
                        </div>
                    </div>
                </div>

                <!-- KPIs Tab -->
                <div class="tab-panel" id="kpisTab">
                    <div class="kpi-card">
                        <div class="kpi-title">ğŸ“Š Ù†Ø³Ø¨Ø© Ø§Ù„Ø¥Ø´ØºØ§Ù„</div>
                        <div class="kpi-value" id="kpiOccupancy">0%</div>
                        <div class="progress-bar">
                            <div class="progress-fill blue" id="occupancyBar" style="width: 0%;"></div>
                        </div>
                    </div>
                    <div class="kpi-card">
                        <div class="kpi-title">â±ï¸ Ù…ØªÙˆØ³Ø· ÙˆÙ‚Øª Ø§Ù„Ø§Ù†ØªØ¸Ø§Ø±</div>
                        <div class="kpi-value" id="kpiAvgWait">0 Ø¯</div>
                    </div>
                    <div class="kpi-card">
                        <div class="kpi-title">ğŸ“ˆ ØªÙˆØ²ÙŠØ¹ Ø§Ù„Ø­Ø§Ù„Ø§Øª</div>
                        <div class="kpi-chart" id="statusChart" style="background: linear-gradient(90deg, var(--green) 33%, var(--blue) 33% 66%, var(--red) 66%);"></div>
                        <div style="display: flex; justify-content: space-between; margin-top: 10px; font-size: 0.85rem;">
                            <span style="color: var(--green);" id="kpiEarlyPct">0%</span>
                            <span style="color: var(--blue);" id="kpiOntimePct">0%</span>
                            <span style="color: var(--red);" id="kpiLatePct">0%</span>
                        </div>
                    </div>
                    <div class="kpi-card">
                        <div class="kpi-title">ğŸšŒ Ø­Ø§ÙÙ„Ø§Øª Ø§Ù„ÙŠÙˆÙ…</div>
                        <div class="kpi-value" id="kpiDailyBuses">0</div>
                        <div class="kpi-subtitle">Ø­Ø§ÙÙ„Ø© ØªÙ…Øª Ù…Ø¹Ø§Ù„Ø¬ØªÙ‡Ø§</div>
                    </div>
                    <div class="kpi-card">
                        <div class="kpi-title">ğŸ‘¥ Ù…Ø³Ø§ÙØ±ÙŠÙ† Ø§Ù„ÙŠÙˆÙ…</div>
                        <div class="kpi-value" id="kpiDailyPax">0</div>
                        <div class="kpi-subtitle">Ù…Ø³Ø§ÙØ±</div>
                    </div>
                </div>

                <!-- Forms Tab -->
                <div class="tab-panel" id="formsTab">
                    <div class="form-card" onclick="openFormFromTab('ScrLogIn')">
                        <div class="form-card-header">
                            <span class="form-card-icon">ğŸšŒ</span>
                            <span class="form-card-title">ScrLogIn</span>
                        </div>
                        <div class="form-card-desc">ØªØ³Ø¬ÙŠÙ„ Ø¯Ø®ÙˆÙ„ Ø§Ù„Ø­Ø§ÙÙ„Ø© Ù„Ù„Ù…ÙˆÙ‚Ù</div>
                    </div>
                    <div class="form-card" onclick="openFormFromTab('ScrSegregationIn')">
                        <div class="form-card-header">
                            <span class="form-card-icon">ğŸ“¥</span>
                            <span class="form-card-title">ScrSegregationIn</span>
                        </div>
                        <div class="form-card-desc">ØªØ³Ø¬ÙŠÙ„ Ø¯Ø®ÙˆÙ„ Ù…Ù†Ø·Ù‚Ø© Ø§Ù„ÙØ±Ø²</div>
                    </div>
                    <div class="form-card" onclick="openFormFromTab('ScrWelcomeLounge')">
                        <div class="form-card-header">
                            <span class="form-card-icon">â˜•</span>
                            <span class="form-card-title">ScrWelcomeLounge</span>
                        </div>
                        <div class="form-card-desc">ØªØ³Ø¬ÙŠÙ„ Ø¨ÙŠØ§Ù†Ø§Øª ØµØ§Ù„Ø© Ø§Ù„ØªØ±Ø­ÙŠØ¨ (ÙŠØ¸Ù‡Ø± ÙÙŠ Ø§Ù„Ù…ÙˆÙ‚Ù)</div>
                    </div>
                    <div class="form-card" onclick="openFormFromTab('ScrSegregationExit')">
                        <div class="form-card-header">
                            <span class="form-card-icon">ğŸ“¤</span>
                            <span class="form-card-title">ScrSegregationExit</span>
                        </div>
                        <div class="form-card-desc">ØªØ³Ø¬ÙŠÙ„ Ø®Ø±ÙˆØ¬ Ù…Ù† Ù…Ù†Ø·Ù‚Ø© Ø§Ù„ÙØ±Ø² (ÙŠØ®Ù„ÙŠ Ø§Ù„Ù…ÙˆÙ‚Ù)</div>
                    </div>
                    <div class="form-card" onclick="openFormFromTab('ScrCurbside')">
                        <div class="form-card-header">
                            <span class="form-card-icon">ğŸ›‘</span>
                            <span class="form-card-title">ScrCurbside</span>
                        </div>
                        <div class="form-card-desc">ØªØ³Ø¬ÙŠÙ„ Ø¹Ù†Ø¯ Ù†Ù‚Ø·Ø© Ø§Ù„Ø¥Ù†Ø²Ø§Ù„</div>
                    </div>
                </div>

                <!-- Registered Buses Tab -->
                <div class="tab-panel" id="busesTab">
                    <div id="busRecordsList">
                        <div style="text-align: center; color: var(--text-muted); padding: 30px;">
                            Ù„Ø§ ØªÙˆØ¬Ø¯ Ø­Ø§ÙÙ„Ø§Øª Ù…Ø³Ø¬Ù„Ø©
                        </div>
                    </div>
                </div>
            </div>
        </aside>
    </div>

    <!-- Footer -->
    <div class="footer">
        <div class="footer-text">
            Ø¥Ø¯Ø§Ø±Ø© Ø¹Ù…Ù„ÙŠØ§Øª Ø§Ù„Ø³Ø§Ø­Ø§Øª Ø§Ù„Ø®Ø§Ø±Ø¬ÙŠØ© ÙˆØ§Ù„Ù…ÙˆØ§ØµÙ„Ø§Øª v3.0 | Ù…ØªÙˆØ§ÙÙ‚ Ù…Ø¹ Power BI | Ø¢Ø®Ø± ØªØ­Ø¯ÙŠØ«: <span id="lastUpdate">--:--:--</span>
        </div>
    </div>

    <!-- Modal -->
    <div class="modal-overlay" id="modalOverlay">
        <div class="modal">
            <div class="modal-header">
                <h3 class="modal-title" id="modalTitle">Ù†Ù…ÙˆØ°Ø¬ Ø¬Ø¯ÙŠØ¯</h3>
                <button class="modal-close" onclick="closeModal()">&times;</button>
            </div>
            <div class="modal-body" id="modalBody"></div>
            <div class="modal-footer" id="modalFooter">
                <button class="btn btn-secondary" onclick="closeModal()">Ø¥Ù„ØºØ§Ø¡</button>
                <button class="btn btn-primary" onclick="saveForm()">ğŸ’¾ Ø­ÙØ¸</button>
            </div>
        </div>
    </div>

    <!-- Tooltip -->
    <div class="tooltip" id="tooltip"></div>

    <script>
        // â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
        // DATA STORE - Ù…ØªÙˆØ§ÙÙ‚ Ù…Ø¹ Power BI
        // â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
        
        let busRecords = [];
        let alerts = [];
        let dailyStats = { buses: 0, passengers: 0, flights: new Set() };
        let currentSpot = null;
        let currentForm = null;
        let currentBusPlate = null;
        let editMode = false;
        let settings = {
            sound: false,
            popup: true,
            earlyThreshold: 7,
            lateThreshold: 3
        };

        // â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
        // INITIALIZE
        // â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
        
        document.addEventListener('DOMContentLoaded', () => {
            try {
                renderParkingSections();
                initializeSampleBuses(); // 30 Ø­Ø§ÙÙ„Ø© ØªØ¬Ø±ÙŠØ¨ÙŠØ©
                updateStatistics();
                updateTimeAndShift();
                updateBusRecordsList();

                setInterval(() => {
                    try {
                        updateTimeAndShift();
                    } catch (e) {
                        console.warn('Ø®Ø·Ø£ ÙÙŠ ØªØ­Ø¯ÙŠØ« Ø§Ù„ÙˆÙ‚Øª:', e);
                    }
                }, 1000);

                setInterval(() => {
                    try {
                        updateCountdowns();
                    } catch (e) {
                        console.warn('Ø®Ø·Ø£ ÙÙŠ ØªØ­Ø¯ÙŠØ« Ø§Ù„Ø¹Ø¯ Ø§Ù„ØªÙ†Ø§Ø²Ù„ÙŠ:', e);
                    }
                }, 1000);

                setInterval(() => {
                    try {
                        renderParkingSections();
                        updateStatistics();
                    } catch (e) {
                        console.warn('Ø®Ø·Ø£ ÙÙŠ Ø§Ù„ØªØ­Ø¯ÙŠØ« Ø§Ù„Ø¯ÙˆØ±ÙŠ:', e);
                    }
                }, 30000);

                // Close form menu on outside click
                document.addEventListener('click', (e) => {
                    try {
                        const menu = document.getElementById('formMenu');
                        if (menu && !menu.contains(e.target) && !e.target.closest('.parking-spot')) {
                            menu.classList.remove('show');
                        }
                    } catch (clickError) {
                        console.warn('Ø®Ø·Ø£ ÙÙŠ Ù…Ø¹Ø§Ù„Ø¬Ø© Ø§Ù„Ù†Ù‚Ø±:', clickError);
                    }
                });

                console.log('âœ… ØªÙ… ØªØ­Ù…ÙŠÙ„ Ø§Ù„ØªØ·Ø¨ÙŠÙ‚ Ø¨Ù†Ø¬Ø§Ø­');
            } catch (error) {
                console.error('âŒ Ø®Ø·Ø£ ÙÙŠ ØªÙ‡ÙŠØ¦Ø© Ø§Ù„ØªØ·Ø¨ÙŠÙ‚:', error);
                alert('Ø­Ø¯Ø« Ø®Ø·Ø£ Ø£Ø«Ù†Ø§Ø¡ ØªØ­Ù…ÙŠÙ„ Ø§Ù„ØªØ·Ø¨ÙŠÙ‚. ÙŠØ±Ø¬Ù‰ ØªØ­Ø¯ÙŠØ« Ø§Ù„ØµÙØ­Ø©.');
            }
        });

        // â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
        // 30 SAMPLE BUSES
        // â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
        
        function initializeSampleBuses() {
            try {
                const now = new Date();
                const samples = [
                    // Ù…Ø¨ÙƒØ± (10 Ø­Ø§ÙÙ„Ø§Øª)
                    { plate: 'ABC 1001', spot: 1, flight: 'SV1001', pax: 45, gate: 'G10', hoursOffset: 10 },
                    { plate: 'ABC 1002', spot: 3, flight: 'SV1002', pax: 52, gate: 'G12', hoursOffset: 12 },
                    { plate: 'ABC 1003', spot: 5, flight: 'SV1003', pax: 48, gate: 'G15', hoursOffset: 9 },
                    { plate: 'ABC 1004', spot: 7, flight: 'SV1004', pax: 50, gate: 'G18', hoursOffset: 11 },
                    { plate: 'ABC 1005', spot: 9, flight: 'SV1005', pax: 47, gate: 'G20', hoursOffset: 8 },
                    { plate: 'ABC 1006', spot: 11, flight: 'SV1006', pax: 55, gate: 'G22', hoursOffset: 14 },
                    { plate: 'ABC 1007', spot: 13, flight: 'SV1007', pax: 43, gate: 'G25', hoursOffset: 10 },
                    { plate: 'ABC 1008', spot: 15, flight: 'SV1008', pax: 51, gate: 'G28', hoursOffset: 9 },
                    { plate: 'ABC 1009', spot: 43, flight: 'SV1009', pax: 49, gate: 'G30', hoursOffset: 12 },
                    { plate: 'ABC 1010', spot: 45, flight: 'SV1010', pax: 46, gate: 'G32', hoursOffset: 8 },

                    // ÙÙŠ Ø§Ù„Ù…ÙˆØ¹Ø¯ (10 Ø­Ø§ÙÙ„Ø§Øª)
                    { plate: 'DEF 2001', spot: 17, flight: 'SV2001', pax: 44, gate: 'G11', hoursOffset: 5 },
                    { plate: 'DEF 2002', spot: 19, flight: 'SV2002', pax: 53, gate: 'G13', hoursOffset: 6 },
                    { plate: 'DEF 2003', spot: 21, flight: 'SV2003', pax: 47, gate: 'G16', hoursOffset: 4 },
                    { plate: 'DEF 2004', spot: 23, flight: 'SV2004', pax: 50, gate: 'G19', hoursOffset: 5.5 },
                    { plate: 'DEF 2005', spot: 25, flight: 'SV2005', pax: 48, gate: 'G21', hoursOffset: 6.5 },
                    { plate: 'DEF 2006', spot: 27, flight: 'SV2006', pax: 52, gate: 'G23', hoursOffset: 4.5 },
                    { plate: 'DEF 2007', spot: 47, flight: 'SV2007', pax: 45, gate: 'G26', hoursOffset: 5 },
                    { plate: 'DEF 2008', spot: 49, flight: 'SV2008', pax: 54, gate: 'G29', hoursOffset: 6 },
                    { plate: 'DEF 2009', spot: 51, flight: 'SV2009', pax: 46, gate: 'G31', hoursOffset: 4 },
                    { plate: 'DEF 2010', spot: 53, flight: 'SV2010', pax: 49, gate: 'G33', hoursOffset: 5.5 },

                    // Ù…ØªØ£Ø®Ø± (10 Ø­Ø§ÙÙ„Ø§Øª)
                    { plate: 'GHI 3001', spot: 29, flight: 'SV3001', pax: 51, gate: 'G14', hoursOffset: 2 },
                    { plate: 'GHI 3002', spot: 31, flight: 'SV3002', pax: 47, gate: 'G17', hoursOffset: 1.5 },
                    { plate: 'GHI 3003', spot: 33, flight: 'SV3003', pax: 53, gate: 'G24', hoursOffset: 0.5 },
                    { plate: 'GHI 3004', spot: 35, flight: 'SV3004', pax: 48, gate: 'G27', hoursOffset: 2.5 },
                    { plate: 'GHI 3005', spot: 37, flight: 'SV3005', pax: 50, gate: 'G34', hoursOffset: 1 },
                    { plate: 'GHI 3006', spot: 39, flight: 'SV3006', pax: 44, gate: 'G35', hoursOffset: 0.25 },
                    { plate: 'GHI 3007', spot: 55, flight: 'SV3007', pax: 52, gate: 'G36', hoursOffset: 2 },
                    { plate: 'GHI 3008', spot: 57, flight: 'SV3008', pax: 46, gate: 'G37', hoursOffset: 1.5 },
                    { plate: 'GHI 3009', spot: 59, flight: 'SV3009', pax: 55, gate: 'G38', hoursOffset: 0.5 },
                    { plate: 'GHI 3010', spot: 61, flight: 'SV3010', pax: 49, gate: 'G39', hoursOffset: -0.25 }
                ];

                let successCount = 0;
                samples.forEach(s => {
                    try {
                        if (!s.plate || !s.spot || s.spot < 1 || s.spot > 87) {
                            console.warn('Ø¨ÙŠØ§Ù†Ø§Øª Ø­Ø§ÙÙ„Ø© ØªØ¬Ø±ÙŠØ¨ÙŠØ© ØºÙŠØ± ØµØ§Ù„Ø­Ø©:', s);
                            return;
                        }

                        const arrTime = new Date(now.getTime() - 2*60*60*1000);
                        const depTime = new Date(now.getTime() + s.hoursOffset*60*60*1000);

                        if (isNaN(arrTime.getTime()) || isNaN(depTime.getTime())) {
                            console.warn('ÙˆÙ‚Øª ØºÙŠØ± ØµØ§Ù„Ø­ Ù„Ù„Ø­Ø§ÙÙ„Ø©:', s.plate);
                            return;
                        }

                        const bus = {
                            BusPlate: s.plate,
                            spotNumber: s.spot,
                            forms: {
                                ScrLogIn: { timestamp: arrTime.toISOString(), FlightNO: s.flight, PaxAdlt: s.pax },
                                ScrWelcomeLounge: {
                                    timestamp: arrTime.toISOString(),
                                    ParkNO: s.spot,
                                    ArrTime: arrTime.toTimeString().slice(0,5),
                                    DepTime: depTime.toTimeString().slice(0,5),
                                    FlightNO: s.flight,
                                    PaxAdlt: s.pax,
                                    GateNO: s.gate
                                }
                            },
                            displayData: {
                                plate: s.plate,
                                flight: s.flight,
                                pax: s.pax,
                                gate: s.gate,
                                arrival: arrTime.toTimeString().slice(0,5),
                                departure: depTime.toTimeString().slice(0,5),
                                depTime: depTime
                            },
                            createdAt: arrTime.toISOString(),
                            lastUpdated: now.toISOString()
                        };

                        busRecords.push(bus);
                        dailyStats.buses++;
                        dailyStats.passengers += (parseInt(s.pax) || 0);
                        if (s.flight) dailyStats.flights.add(s.flight);
                        successCount++;
                    } catch (busError) {
                        console.warn('Ø®Ø·Ø£ ÙÙŠ Ø¥Ù†Ø´Ø§Ø¡ Ø­Ø§ÙÙ„Ø© ØªØ¬Ø±ÙŠØ¨ÙŠØ©:', busError, s);
                    }
                });

                renderParkingSections();
                showNotification('info', 'Ø¨ÙŠØ§Ù†Ø§Øª ØªØ¬Ø±ÙŠØ¨ÙŠØ©', `ØªÙ… ØªØ­Ù…ÙŠÙ„ ${successCount} Ø­Ø§ÙÙ„Ø© Ù„Ù„Ù…Ø¹Ø§ÙŠÙ†Ø©`);
            } catch (error) {
                console.error('Ø®Ø·Ø£ ÙÙŠ ØªÙ‡ÙŠØ¦Ø© Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„ØªØ¬Ø±ÙŠØ¨ÙŠØ©:', error);
                showNotification('warning', 'ØªÙ†Ø¨ÙŠÙ‡', 'ÙØ´Ù„ ÙÙŠ ØªØ­Ù…ÙŠÙ„ Ø¨Ø¹Ø¶ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„ØªØ¬Ø±ÙŠØ¨ÙŠØ©');
            }
        }

        // â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
        // PARKING SECTIONS
        // â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
        
        function renderParkingSections() {
            try {
                const entranceSection = document.getElementById('entranceSection');
                const exitSection = document.getElementById('exitSection');

                if (!entranceSection || !exitSection) {
                    console.error('Ù„Ù… ÙŠØªÙ… Ø§Ù„Ø¹Ø«ÙˆØ± Ø¹Ù„Ù‰ Ø£Ù‚Ø³Ø§Ù… Ø§Ù„Ù…ÙˆØ§Ù‚Ù');
                    return;
                }

                entranceSection.innerHTML = '';
                exitSection.innerHTML = '';

                // Ø¬Ù‡Ø© Ø§Ù„Ù…Ø¯Ø®Ù„: 3 ØµÙÙˆÙ Ã— 14 = 42
                let spotNumber = 1;
                for (let row = 0; row < 3; row++) {
                    const rowDiv = document.createElement('div');
                    rowDiv.className = 'parking-row';
                    for (let i = 0; i < 14; i++) {
                        try {
                            const bus = busRecords.find(b => b && b.spotNumber === spotNumber && b.forms && b.forms.ScrWelcomeLounge);
                            rowDiv.appendChild(createParkingSpot(spotNumber, bus));
                        } catch (spotError) {
                            console.warn(`Ø®Ø·Ø£ ÙÙŠ Ø¥Ù†Ø´Ø§Ø¡ Ø§Ù„Ù…ÙˆÙ‚Ù ${spotNumber}:`, spotError);
                            const emptySpot = document.createElement('div');
                            emptySpot.className = 'parking-spot empty';
                            emptySpot.innerHTML = `<div class="spot-number">#${spotNumber}</div><div class="empty-text">âš ï¸</div>`;
                            rowDiv.appendChild(emptySpot);
                        }
                        spotNumber++;
                    }
                    entranceSection.appendChild(rowDiv);
                }

                // Ø¬Ù‡Ø© Ø§Ù„Ù…Ø®Ø±Ø¬: 3 ØµÙÙˆÙ Ã— 15 = 45
                for (let row = 0; row < 3; row++) {
                    const rowDiv = document.createElement('div');
                    rowDiv.className = 'parking-row';
                    for (let i = 0; i < 15; i++) {
                        try {
                            const bus = busRecords.find(b => b && b.spotNumber === spotNumber && b.forms && b.forms.ScrWelcomeLounge);
                            rowDiv.appendChild(createParkingSpot(spotNumber, bus));
                        } catch (spotError) {
                            console.warn(`Ø®Ø·Ø£ ÙÙŠ Ø¥Ù†Ø´Ø§Ø¡ Ø§Ù„Ù…ÙˆÙ‚Ù ${spotNumber}:`, spotError);
                            const emptySpot = document.createElement('div');
                            emptySpot.className = 'parking-spot empty';
                            emptySpot.innerHTML = `<div class="spot-number">#${spotNumber}</div><div class="empty-text">âš ï¸</div>`;
                            rowDiv.appendChild(emptySpot);
                        }
                        spotNumber++;
                    }
                    exitSection.appendChild(rowDiv);
                }
            } catch (error) {
                console.error('Ø®Ø·Ø£ ÙÙŠ Ø¹Ø±Ø¶ Ø£Ù‚Ø³Ø§Ù… Ø§Ù„Ù…ÙˆØ§Ù‚Ù:', error);
                showNotification('error', 'Ø®Ø·Ø£', 'ÙØ´Ù„ ÙÙŠ ØªØ­Ù…ÙŠÙ„ Ø§Ù„Ù…ÙˆØ§Ù‚Ù');
            }
        }

        function createParkingSpot(spotNumber, bus) {
            const spot = document.createElement('div');
            spot.id = `spot-${spotNumber}`;
            
            if (bus && bus.displayData) {
                const statusInfo = calculateStatus(bus.displayData.arrival, bus.displayData.departure);
                spot.className = `parking-spot ${statusInfo.status}`;
                
                const countdown = getCountdownString(bus.displayData.depTime);
                
                spot.innerHTML = `
                    <div class="spot-number">#${spotNumber}</div>
                    <div class="spot-status-badge ${statusInfo.status}">${statusInfo.label}</div>
                    <div class="bus-info">
                        <div class="info-line">
                            <span class="info-icon">ğŸšŒ</span>
                            <span class="info-text">${bus.displayData.plate}</span>
                        </div>
                        <div class="info-line">
                            <span class="info-icon">âœˆï¸</span>
                            <span class="info-text">${bus.displayData.flight}</span>
                        </div>
                        <div class="info-line">
                            <span class="info-icon">ğŸ‘¥</span>
                            <span class="info-text">${bus.displayData.pax} Ø±Ø§ÙƒØ¨</span>
                        </div>
                        <div class="info-line">
                            <span class="info-icon">ğŸšª</span>
                            <span class="info-text">${bus.displayData.gate}</span>
                        </div>
                        <div class="info-line">
                            <span class="info-icon">ğŸ“¤</span>
                            <span class="info-text">${bus.displayData.departure}</span>
                        </div>
                    </div>
                    <div class="time-diff">
                        <span class="countdown" data-dep="${bus.displayData.depTime}">${countdown}</span>
                    </div>
                `;
                
                spot.addEventListener('mouseenter', (e) => showTooltip(e, bus.displayData, statusInfo));
                spot.addEventListener('mouseleave', hideTooltip);
                spot.addEventListener('mousemove', moveTooltip);
            } else {
                spot.className = 'parking-spot empty';
                spot.innerHTML = `
                    <div class="spot-number">#${spotNumber}</div>
                    <div class="empty-text">â¬œ</div>
                `;
            }
            
            spot.onclick = (e) => handleSpotClick(spotNumber, e);
            return spot;
        }

        function calculateStatus(arrival, departure) {
            try {
                if (!departure || departure === '-') {
                    return { status: 'ontime', label: 'ØºÙŠØ± Ù…Ø­Ø¯Ø¯', hours: 0 };
                }

                const now = new Date();
                const today = now.toISOString().slice(0,10);

                let depTime = new Date(`${today}T${departure}`);
                if (isNaN(depTime.getTime())) {
                    console.warn('ÙˆÙ‚Øª Ø§Ù„Ø¥Ù‚Ù„Ø§Ø¹ ØºÙŠØ± ØµØ§Ù„Ø­:', departure);
                    return { status: 'ontime', label: 'ØºÙŠØ± Ù…Ø­Ø¯Ø¯', hours: 0 };
                }

                if (depTime < now) depTime.setDate(depTime.getDate() + 1);

                const diffHours = (depTime - now) / (1000 * 60 * 60);

                const earlyThreshold = settings?.earlyThreshold || 7;
                const lateThreshold = settings?.lateThreshold || 3;

                if (diffHours > earlyThreshold) return { status: 'early', label: 'Ù…Ø¨ÙƒØ±', hours: diffHours };
                if (diffHours < lateThreshold) return { status: 'late', label: 'Ù…ØªØ£Ø®Ø±', hours: diffHours };
                return { status: 'ontime', label: 'ÙÙŠ Ø§Ù„Ù…ÙˆØ¹Ø¯', hours: diffHours };
            } catch (error) {
                console.error('Ø®Ø·Ø£ ÙÙŠ Ø­Ø³Ø§Ø¨ Ø§Ù„Ø­Ø§Ù„Ø©:', error);
                return { status: 'ontime', label: 'Ø®Ø·Ø£', hours: 0 };
            }
        }

        function getCountdownString(depTime) {
            try {
                if (!depTime) return '--:--';

                const now = new Date();
                const dep = new Date(depTime);

                if (isNaN(dep.getTime())) {
                    console.warn('ÙˆÙ‚Øª Ø§Ù„Ø¥Ù‚Ù„Ø§Ø¹ ØºÙŠØ± ØµØ§Ù„Ø­:', depTime);
                    return '--:--';
                }

                const diff = dep - now;

                if (diff <= 0) return 'âš ï¸ Ù…ØªØ£Ø®Ø±!';

                const hours = Math.floor(diff / (1000 * 60 * 60));
                const mins = Math.floor((diff % (1000 * 60 * 60)) / (1000 * 60));
                const secs = Math.floor((diff % (1000 * 60)) / 1000);

                return `${hours.toString().padStart(2,'0')}:${mins.toString().padStart(2,'0')}:${secs.toString().padStart(2,'0')}`;
            } catch (error) {
                console.warn('Ø®Ø·Ø£ ÙÙŠ Ø­Ø³Ø§Ø¨ Ø§Ù„Ø¹Ø¯ Ø§Ù„ØªÙ†Ø§Ø²Ù„ÙŠ:', error);
                return '--:--';
            }
        }

        function updateCountdowns() {
            document.querySelectorAll('.countdown[data-dep]').forEach(el => {
                const depTime = new Date(el.dataset.dep);
                el.textContent = getCountdownString(depTime);
            });
        }

        // â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
        // SPOT CLICK HANDLER
        // â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
        
        function handleSpotClick(spotNumber, event) {
            event.stopPropagation();
            const bus = busRecords.find(b => b.spotNumber === spotNumber && b.forms.ScrWelcomeLounge);
            
            if (bus) {
                // Ù…ÙˆÙ‚Ù Ù…Ø´ØºÙˆÙ„ - ÙØªØ­ ScrWelcomeLounge Ù„Ù„ØªØ¹Ø¯ÙŠÙ„
                currentSpot = spotNumber;
                currentForm = 'ScrWelcomeLounge';
                currentBusPlate = bus.BusPlate;
                openFormModal('ScrWelcomeLounge', bus);
            } else {
                // Ù…ÙˆÙ‚Ù ÙØ§Ø±Øº - Ø¥Ø¸Ù‡Ø§Ø± Ù‚Ø§Ø¦Ù…Ø© Ø§Ù„Ù†Ù…Ø§Ø°Ø¬
                currentSpot = spotNumber;
                showFormMenu(event);
            }
        }

        function showFormMenu(event) {
            const menu = document.getElementById('formMenu');
            menu.style.top = event.clientY + 'px';
            menu.style.left = (event.clientX - 220) + 'px';
            menu.classList.add('show');
        }

        function selectForm(formName) {
            document.getElementById('formMenu').classList.remove('show');
            currentForm = formName;
            openFormModal(formName, null);
        }

        function openFormFromTab(formName) {
            currentSpot = null;
            currentForm = formName;
            openFormModal(formName, null);
        }

        // â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
        // FORM MODAL
        // â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
        
        function openFormModal(formName, existingBus) {
            const modal = document.getElementById('modalOverlay');
            const title = document.getElementById('modalTitle');
            const body = document.getElementById('modalBody');
            
            const titles = {
                'ScrLogIn': 'ğŸšŒ ScrLogIn - ØªØ³Ø¬ÙŠÙ„ Ø§Ù„Ø¯Ø®ÙˆÙ„',
                'ScrSegregationIn': 'ğŸ“¥ ScrSegregationIn - Ø¯Ø®ÙˆÙ„ Ø§Ù„ÙØ±Ø²',
                'ScrWelcomeLounge': 'â˜• ScrWelcomeLounge - ØµØ§Ù„Ø© Ø§Ù„ØªØ±Ø­ÙŠØ¨',
                'ScrSegregationExit': 'ğŸ“¤ ScrSegregationExit - Ø®Ø±ÙˆØ¬ Ø§Ù„ÙØ±Ø²',
                'ScrCurbside': 'ğŸ›‘ ScrCurbside - Ù†Ù‚Ø·Ø© Ø§Ù„Ø¥Ù†Ø²Ø§Ù„'
            };
            
            title.textContent = titles[formName] + (currentSpot ? ` - Ù…ÙˆÙ‚Ù ${currentSpot}` : '');
            body.innerHTML = getFormHTML(formName, existingBus);
            modal.classList.add('show');
        }

        function getFormHTML(formName, bus) {
            const plate = bus ? bus.BusPlate : (currentBusPlate || '');
            const now = new Date();
            const timeStr = now.toTimeString().slice(0,5);
            
            switch(formName) {
                case 'ScrLogIn':
                    return `
                        <div class="form-section">
                            <div class="form-section-title">ğŸšŒ Ø¨ÙŠØ§Ù†Ø§Øª ØªØ³Ø¬ÙŠÙ„ Ø§Ù„Ø¯Ø®ÙˆÙ„</div>
                            <div class="form-row">
                                <div class="form-group">
                                    <label>Ù„ÙˆØ­Ø© Ø§Ù„Ø­Ø§ÙÙ„Ø© (BusPlate)</label>
                                    <input type="text" id="BusPlate" value="${plate}" placeholder="ABC 1234">
                                </div>
                                <div class="form-group">
                                    <label>Ø±Ù‚Ù… Ø§Ù„Ø±Ø­Ù„Ø© (FlightNO)</label>
                                    <input type="text" id="FlightNO" placeholder="SV 1234">
                                </div>
                            </div>
                            <div class="form-row">
                                <div class="form-group">
                                    <label>Ø¹Ø¯Ø¯ Ø§Ù„Ø±ÙƒØ§Ø¨ (PaxAdlt)</label>
                                    <input type="number" id="PaxAdlt" placeholder="45">
                                </div>
                                <div class="form-group">
                                    <label>ÙˆÙ‚Øª Ø§Ù„ØªØ³Ø¬ÙŠÙ„ (LogTime)</label>
                                    <input type="time" id="LogTime" value="${timeStr}">
                                </div>
                            </div>
                        </div>
                    `;
                
                case 'ScrSegregationIn':
                    return `
                        <div class="form-section">
                            <div class="form-section-title">ğŸ“¥ Ø¨ÙŠØ§Ù†Ø§Øª Ø¯Ø®ÙˆÙ„ Ø§Ù„ÙØ±Ø²</div>
                            <div class="form-row">
                                <div class="form-group">
                                    <label>Ù„ÙˆØ­Ø© Ø§Ù„Ø­Ø§ÙÙ„Ø© (BusPlate)</label>
                                    <input type="text" id="BusPlate" value="${plate}">
                                </div>
                                <div class="form-group">
                                    <label>ÙˆÙ‚Øª Ø§Ù„Ø¯Ø®ÙˆÙ„ (EntryTime)</label>
                                    <input type="time" id="EntryTime" value="${timeStr}">
                                </div>
                            </div>
                            <div class="form-row">
                                <div class="form-group">
                                    <label>Ø¨ÙˆØ§Ø¨Ø© Ø§Ù„Ø¯Ø®ÙˆÙ„ (EntryGate)</label>
                                    <select id="EntryGate">
                                        <option value="">Ø§Ø®ØªØ±...</option>
                                        <option value="G1">Ø¨ÙˆØ§Ø¨Ø© 1</option>
                                        <option value="G2">Ø¨ÙˆØ§Ø¨Ø© 2</option>
                                        <option value="G3">Ø¨ÙˆØ§Ø¨Ø© 3</option>
                                    </select>
                                </div>
                                <div class="form-group">
                                    <label>Ø­Ø§Ù„Ø© Ø§Ù„ÙØ­Øµ (InspectionStatus)</label>
                                    <select id="InspectionStatus">
                                        <option value="passed">Ù†Ø§Ø¬Ø­</option>
                                        <option value="pending">Ù‚ÙŠØ¯ Ø§Ù„Ù…Ø±Ø§Ø¬Ø¹Ø©</option>
                                        <option value="failed">ÙØ´Ù„</option>
                                    </select>
                                </div>
                            </div>
                        </div>
                    `;
                
                case 'ScrWelcomeLounge':
                    const existingData = bus?.forms?.ScrWelcomeLounge || {};
                    return `
                        <div class="form-section">
                            <div class="form-section-title">â˜• Ø¨ÙŠØ§Ù†Ø§Øª ØµØ§Ù„Ø© Ø§Ù„ØªØ±Ø­ÙŠØ¨ (ØªØ¸Ù‡Ø± ÙÙŠ Ø§Ù„Ù…ÙˆØ§Ù‚Ù)</div>
                            <div class="form-row">
                                <div class="form-group">
                                    <label>Ù„ÙˆØ­Ø© Ø§Ù„Ø­Ø§ÙÙ„Ø© (BusPlate)</label>
                                    <input type="text" id="BusPlate" value="${plate}">
                                </div>
                                <div class="form-group">
                                    <label>Ø±Ù‚Ù… Ø§Ù„Ù…ÙˆÙ‚Ù (ParkNO) - 1 Ø¥Ù„Ù‰ 87</label>
                                    <input type="number" id="ParkNO" value="${existingData.ParkNO || currentSpot || ''}" min="1" max="87">
                                </div>
                            </div>
                            <div class="form-row">
                                <div class="form-group">
                                    <label>Ø±Ù‚Ù… Ø§Ù„Ø±Ø­Ù„Ø© (FlightNO)</label>
                                    <input type="text" id="FlightNO" value="${existingData.FlightNO || ''}" placeholder="SV 1234">
                                </div>
                                <div class="form-group">
                                    <label>Ø¹Ø¯Ø¯ Ø§Ù„Ø±ÙƒØ§Ø¨ (PaxAdlt)</label>
                                    <input type="number" id="PaxAdlt" value="${existingData.PaxAdlt || ''}" placeholder="45">
                                </div>
                            </div>
                            <div class="form-row">
                                <div class="form-group">
                                    <label>ÙˆÙ‚Øª Ø§Ù„ÙˆØµÙˆÙ„ (ArrTime)</label>
                                    <input type="time" id="ArrTime" value="${existingData.ArrTime || timeStr}">
                                </div>
                                <div class="form-group">
                                    <label>ÙˆÙ‚Øª Ø§Ù„Ø¥Ù‚Ù„Ø§Ø¹ (DepTime)</label>
                                    <input type="time" id="DepTime" value="${existingData.DepTime || ''}">
                                </div>
                            </div>
                            <div class="form-row">
                                <div class="form-group">
                                    <label>Ø±Ù‚Ù… Ø§Ù„Ø¨ÙˆØ§Ø¨Ø© (GateNO)</label>
                                    <input type="text" id="GateNO" value="${existingData.GateNO || ''}" placeholder="G10">
                                </div>
                                <div class="form-group">
                                    <label>Ø±Ù‚Ù… Ø§Ù„ØµØ§Ù„Ø© (LoungeNO)</label>
                                    <select id="LoungeNO">
                                        <option value="">Ø§Ø®ØªØ±...</option>
                                        <option value="L1">ØµØ§Ù„Ø© 1</option>
                                        <option value="L2">ØµØ§Ù„Ø© 2</option>
                                        <option value="L3">ØµØ§Ù„Ø© 3</option>
                                        <option value="VIP">VIP</option>
                                    </select>
                                </div>
                            </div>
                        </div>
                    `;
                
                case 'ScrSegregationExit':
                    return `
                        <div class="form-section">
                            <div class="form-section-title">ğŸ“¤ Ø¨ÙŠØ§Ù†Ø§Øª Ø®Ø±ÙˆØ¬ Ø§Ù„ÙØ±Ø²</div>
                            <div class="form-row">
                                <div class="form-group">
                                    <label>Ù„ÙˆØ­Ø© Ø§Ù„Ø­Ø§ÙÙ„Ø© (BusPlate)</label>
                                    <input type="text" id="BusPlate" value="${plate}">
                                </div>
                                <div class="form-group">
                                    <label>ÙˆÙ‚Øª Ø§Ù„Ø®Ø±ÙˆØ¬ (ExitTime)</label>
                                    <input type="time" id="ExitTime" value="${timeStr}">
                                </div>
                            </div>
                            <div class="form-row">
                                <div class="form-group">
                                    <label>Ø¨ÙˆØ§Ø¨Ø© Ø§Ù„Ø®Ø±ÙˆØ¬ (ExitGate)</label>
                                    <select id="ExitGate">
                                        <option value="">Ø§Ø®ØªØ±...</option>
                                        <option value="G1">Ø¨ÙˆØ§Ø¨Ø© 1</option>
                                        <option value="G2">Ø¨ÙˆØ§Ø¨Ø© 2</option>
                                        <option value="G3">Ø¨ÙˆØ§Ø¨Ø© 3</option>
                                    </select>
                                </div>
                                <div class="form-group">
                                    <label>Ø­Ø§Ù„Ø© Ø§Ù„Ø®Ø±ÙˆØ¬ (ExitStatus)</label>
                                    <select id="ExitStatus">
                                        <option value="completed">Ù…ÙƒØªÙ…Ù„</option>
                                        <option value="partial">Ø¬Ø²Ø¦ÙŠ</option>
                                        <option value="cancelled">Ù…Ù„ØºÙŠ</option>
                                    </select>
                                </div>
                            </div>
                            <div style="background: rgba(244,67,54,0.15); padding: 15px; border-radius: 10px; margin-top: 15px; border: 2px solid var(--red);">
                                <span style="color: var(--red); font-weight: bold;">âš ï¸ ØªÙ†Ø¨ÙŠÙ‡: Ø¹Ù†Ø¯ Ø¥ÙƒÙ…Ø§Ù„ Ù‡Ø°Ø§ Ø§Ù„Ù†Ù…ÙˆØ°Ø¬ Ø¨Ø­Ø§Ù„Ø© "Ù…ÙƒØªÙ…Ù„" Ø³ÙŠØªÙ… Ø¥Ø®Ù„Ø§Ø¡ Ø§Ù„Ù…ÙˆÙ‚Ù ØªÙ„Ù‚Ø§Ø¦ÙŠØ§Ù‹</span>
                            </div>
                        </div>
                    `;
                
                case 'ScrCurbside':
                    return `
                        <div class="form-section">
                            <div class="form-section-title">ğŸ›‘ Ø¨ÙŠØ§Ù†Ø§Øª Ù†Ù‚Ø·Ø© Ø§Ù„Ø¥Ù†Ø²Ø§Ù„</div>
                            <div class="form-row">
                                <div class="form-group">
                                    <label>Ù„ÙˆØ­Ø© Ø§Ù„Ø­Ø§ÙÙ„Ø© (BusPlate)</label>
                                    <input type="text" id="BusPlate" value="${plate}">
                                </div>
                                <div class="form-group">
                                    <label>ÙˆÙ‚Øª Ø§Ù„ÙˆØµÙˆÙ„ (CurbTime)</label>
                                    <input type="time" id="CurbTime" value="${timeStr}">
                                </div>
                            </div>
                            <div class="form-row">
                                <div class="form-group">
                                    <label>Ù†Ù‚Ø·Ø© Ø§Ù„Ø¥Ù†Ø²Ø§Ù„ (CurbPoint)</label>
                                    <select id="CurbPoint">
                                        <option value="">Ø§Ø®ØªØ±...</option>
                                        <option value="C1">Ù†Ù‚Ø·Ø© 1</option>
                                        <option value="C2">Ù†Ù‚Ø·Ø© 2</option>
                                        <option value="C3">Ù†Ù‚Ø·Ø© 3</option>
                                        <option value="C4">Ù†Ù‚Ø·Ø© 4</option>
                                    </select>
                                </div>
                                <div class="form-group">
                                    <label>Ø¹Ø¯Ø¯ Ø§Ù„Ø±ÙƒØ§Ø¨ Ø§Ù„Ù†Ø§Ø²Ù„ÙŠÙ†</label>
                                    <input type="number" id="DroppedPax" placeholder="45">
                                </div>
                            </div>
                        </div>
                    `;
                
                default:
                    return '<p>Ù†Ù…ÙˆØ°Ø¬ ØºÙŠØ± Ù…Ø¹Ø±ÙˆÙ</p>';
            }
        }

        function closeModal() {
            document.getElementById('modalOverlay').classList.remove('show');
            currentSpot = null;
            currentForm = null;
            currentBusPlate = null;
        }

        function saveForm() {
            try {
                const plateInput = document.getElementById('BusPlate');
                if (!plateInput) {
                    showNotification('error', 'Ø®Ø·Ø£', 'Ù„Ù… ÙŠØªÙ… Ø§Ù„Ø¹Ø«ÙˆØ± Ø¹Ù„Ù‰ Ø­Ù‚Ù„ Ù„ÙˆØ­Ø© Ø§Ù„Ø­Ø§ÙÙ„Ø©');
                    return;
                }

                const plate = plateInput.value.trim().toUpperCase();

                if (!plate) {
                    showNotification('error', 'Ø®Ø·Ø£', 'ÙŠØ±Ø¬Ù‰ Ø¥Ø¯Ø®Ø§Ù„ Ù„ÙˆØ­Ø© Ø§Ù„Ø­Ø§ÙÙ„Ø©');
                    return;
                }

                if (plate.length < 3) {
                    showNotification('error', 'Ø®Ø·Ø£', 'Ù„ÙˆØ­Ø© Ø§Ù„Ø­Ø§ÙÙ„Ø© Ù‚ØµÙŠØ±Ø© Ø¬Ø¯Ø§Ù‹ (ÙŠØ¬Ø¨ Ø£Ù† ØªÙƒÙˆÙ† 3 Ø£Ø­Ø±Ù Ø¹Ù„Ù‰ Ø§Ù„Ø£Ù‚Ù„)');
                    return;
                }

                if (!currentForm) {
                    showNotification('error', 'Ø®Ø·Ø£', 'Ù„Ù… ÙŠØªÙ… ØªØ­Ø¯ÙŠØ¯ Ù†ÙˆØ¹ Ø§Ù„Ù†Ù…ÙˆØ°Ø¬');
                    return;
                }

                let bus = busRecords.find(b => b.BusPlate === plate);

                if (!bus) {
                    bus = {
                        BusPlate: plate,
                        spotNumber: null,
                        forms: {},
                        displayData: null,
                        createdAt: new Date().toISOString(),
                        lastUpdated: new Date().toISOString()
                    };
                    busRecords.push(bus);
                    dailyStats.buses++;
                }

                // Ø¬Ù…Ø¹ Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ù†Ù…ÙˆØ°Ø¬
                const formData = { timestamp: new Date().toISOString() };
                const modalBody = document.getElementById('modalBody');
                if (!modalBody) {
                    showNotification('error', 'Ø®Ø·Ø£', 'Ù„Ù… ÙŠØªÙ… Ø§Ù„Ø¹Ø«ÙˆØ± Ø¹Ù„Ù‰ Ù…Ø­ØªÙˆÙ‰ Ø§Ù„Ù†Ù…ÙˆØ°Ø¬');
                    return;
                }

                modalBody.querySelectorAll('input, select').forEach(el => {
                    if (el.id && el.id !== 'BusPlate') {
                        formData[el.id] = el.value;
                    }
                });

                bus.forms[currentForm] = formData;
                bus.lastUpdated = new Date().toISOString();

                // Ù…Ø¹Ø§Ù„Ø¬Ø© ScrWelcomeLounge - ØªØ­Ø¯ÙŠØ« Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ø¹Ø±Ø¶
                if (currentForm === 'ScrWelcomeLounge') {
                    const parkNO = parseInt(formData.ParkNO);
                    if (isNaN(parkNO) || parkNO < 1 || parkNO > 87) {
                        showNotification('error', 'Ø®Ø·Ø£', 'Ø±Ù‚Ù… Ø§Ù„Ù…ÙˆÙ‚Ù ÙŠØ¬Ø¨ Ø£Ù† ÙŠÙƒÙˆÙ† Ø¨ÙŠÙ† 1 Ùˆ 87');
                        return;
                    }

                    // Ø§Ù„ØªØ­Ù‚Ù‚ Ù…Ù† Ø£Ù† Ø§Ù„Ù…ÙˆÙ‚Ù ØºÙŠØ± Ù…Ø´ØºÙˆÙ„ Ø¨Ø­Ø§ÙÙ„Ø© Ø£Ø®Ø±Ù‰
                    const existingBus = busRecords.find(b => b.spotNumber === parkNO && b.BusPlate !== plate && b.forms.ScrWelcomeLounge);
                    if (existingBus) {
                        showNotification('error', 'Ø®Ø·Ø£', `Ø§Ù„Ù…ÙˆÙ‚Ù ${parkNO} Ù…Ø´ØºÙˆÙ„ Ø¨Ø§Ù„ÙØ¹Ù„ Ø¨Ø§Ù„Ø­Ø§ÙÙ„Ø© ${existingBus.BusPlate}`);
                        return;
                    }

                    bus.spotNumber = parkNO;

                    const now = new Date();
                    const today = now.toISOString().slice(0,10);
                    let depTime = null;

                    if (formData.DepTime) {
                        try {
                            depTime = new Date(`${today}T${formData.DepTime}`);
                            if (isNaN(depTime.getTime())) {
                                throw new Error('ÙˆÙ‚Øª Ø§Ù„Ø¥Ù‚Ù„Ø§Ø¹ ØºÙŠØ± ØµØ§Ù„Ø­');
                            }
                            if (depTime < now) depTime.setDate(depTime.getDate() + 1);
                        } catch (dateError) {
                            console.warn('Ø®Ø·Ø£ ÙÙŠ ØªØ­Ù„ÙŠÙ„ ÙˆÙ‚Øª Ø§Ù„Ø¥Ù‚Ù„Ø§Ø¹:', dateError);
                            depTime = null;
                        }
                    }

                    const paxCount = parseInt(formData.PaxAdlt);
                    if (formData.PaxAdlt && (isNaN(paxCount) || paxCount < 0)) {
                        showNotification('warning', 'ØªÙ†Ø¨ÙŠÙ‡', 'Ø¹Ø¯Ø¯ Ø§Ù„Ø±ÙƒØ§Ø¨ ØºÙŠØ± ØµØ§Ù„Ø­ØŒ ØªÙ… ØªØ¹ÙŠÙŠÙ†Ù‡ Ø¥Ù„Ù‰ 0');
                    }

                    bus.displayData = {
                        plate: plate,
                        flight: formData.FlightNO || '-',
                        pax: isNaN(paxCount) ? 0 : Math.max(0, paxCount),
                        gate: formData.GateNO || '-',
                        arrival: formData.ArrTime || '-',
                        departure: formData.DepTime || '-',
                        depTime: depTime
                    };

                    if (formData.PaxAdlt && !isNaN(paxCount) && paxCount > 0) {
                        dailyStats.passengers += paxCount;
                    }
                    if (formData.FlightNO) dailyStats.flights.add(formData.FlightNO);
                }

                // Ù…Ø¹Ø§Ù„Ø¬Ø© ScrSegregationExit - Ø¥Ø®Ù„Ø§Ø¡ Ø§Ù„Ù…ÙˆÙ‚Ù
                if (currentForm === 'ScrSegregationExit' && formData.ExitStatus === 'completed') {
                    const spotNum = bus.spotNumber;
                    busRecords = busRecords.filter(b => b.BusPlate !== plate);
                    showNotification('success', 'ØªÙ… Ø§Ù„Ø¥Ø®Ù„Ø§Ø¡', `ØªÙ… Ø¥Ø®Ù„Ø§Ø¡ Ø§Ù„Ø­Ø§ÙÙ„Ø© ${plate} Ù…Ù† Ø§Ù„Ù…ÙˆÙ‚Ù ${spotNum || 'ØºÙŠØ± Ù…Ø­Ø¯Ø¯'}`);
                    addAlert('success', 'Ø®Ø±ÙˆØ¬ Ø­Ø§ÙÙ„Ø©', `Ø§Ù„Ø­Ø§ÙÙ„Ø© ${plate} ØºØ§Ø¯Ø±Øª Ø§Ù„Ù…ÙˆÙ‚Ù ${spotNum || 'ØºÙŠØ± Ù…Ø­Ø¯Ø¯'}`);
                    closeModal();
                    renderParkingSections();
                    updateStatistics();
                    updateBusRecordsList();
                    return;
                }

                renderParkingSections();
                updateStatistics();
                updateBusRecordsList();
                showNotification('success', 'ØªÙ… Ø§Ù„Ø­ÙØ¸', `ØªÙ… Ø­ÙØ¸ ${currentForm} Ù„Ù„Ø­Ø§ÙÙ„Ø© ${plate}`);
                addAlert('info', 'ØªØ³Ø¬ÙŠÙ„ Ø¬Ø¯ÙŠØ¯', `${currentForm} - ${plate}`);
                closeModal();
            } catch (error) {
                console.error('Ø®Ø·Ø£ ÙÙŠ Ø­ÙØ¸ Ø§Ù„Ù†Ù…ÙˆØ°Ø¬:', error);
                showNotification('error', 'Ø®Ø·Ø£', 'Ø­Ø¯Ø« Ø®Ø·Ø£ Ø£Ø«Ù†Ø§Ø¡ Ø­ÙØ¸ Ø§Ù„Ù†Ù…ÙˆØ°Ø¬: ' + error.message);
            }
        }

        // â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
        // STATISTICS
        // â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
        
        function updateStatistics() {
            try {
                let early = 0, ontime = 0, late = 0, totalPax = 0;

                if (busRecords && Array.isArray(busRecords)) {
                    busRecords.forEach(bus => {
                        try {
                            if (bus && bus.displayData) {
                                const status = calculateStatus(bus.displayData.arrival, bus.displayData.departure).status;
                                if (status === 'early') early++;
                                else if (status === 'ontime') ontime++;
                                else late++;
                                totalPax += parseInt(bus.displayData.pax) || 0;
                            }
                        } catch (busError) {
                            console.warn('Ø®Ø·Ø£ ÙÙŠ Ù…Ø¹Ø§Ù„Ø¬Ø© Ø¨ÙŠØ§Ù†Ø§Øª Ø­Ø§ÙÙ„Ø©:', busError);
                        }
                    });
                }

                const total = busRecords ? busRecords.filter(b => b && b.displayData).length : 0;
                const occupancy = Math.round((total / 87) * 100);

                // Helper function for safe element update
                const safeSetText = (id, value) => {
                    const el = document.getElementById(id);
                    if (el) el.textContent = value;
                };

                const safeSetStyle = (id, property, value) => {
                    const el = document.getElementById(id);
                    if (el) el.style[property] = value;
                };

                // Stats Bar
                safeSetText('totalBuses', total);
                safeSetText('earlyCount', early);
                safeSetText('ontimeCount', ontime);
                safeSetText('lateCount', late);
                safeSetText('totalPassengers', dailyStats?.passengers || 0);
                safeSetText('totalFlights', dailyStats?.flights?.size || 0);
                safeSetText('occupancyRate', occupancy + '%');

                // Main Tab
                safeSetText('mainTotalBuses', total);
                safeSetText('mainEarlyBuses', early);
                safeSetText('mainOnTimeBuses', ontime);
                safeSetText('mainLateBuses', late);
                safeSetText('mainTotalPax', dailyStats?.passengers || 0);

                // KPIs Tab
                safeSetText('kpiOccupancy', occupancy + '%');
                safeSetStyle('occupancyBar', 'width', occupancy + '%');
                safeSetText('kpiDailyBuses', dailyStats?.buses || 0);
                safeSetText('kpiDailyPax', dailyStats?.passengers || 0);

                if (total > 0) {
                    const earlyPct = Math.round((early / total) * 100);
                    const ontimePct = Math.round((ontime / total) * 100);
                    const latePct = Math.round((late / total) * 100);

                    safeSetText('kpiEarlyPct', earlyPct + '%');
                    safeSetText('kpiOntimePct', ontimePct + '%');
                    safeSetText('kpiLatePct', latePct + '%');

                    safeSetStyle('statusChart', 'background',
                        `linear-gradient(90deg, var(--green) ${earlyPct}%, var(--blue) ${earlyPct}% ${earlyPct+ontimePct}%, var(--red) ${earlyPct+ontimePct}%)`);
                }
            } catch (error) {
                console.error('Ø®Ø·Ø£ ÙÙŠ ØªØ­Ø¯ÙŠØ« Ø§Ù„Ø¥Ø­ØµØ§Ø¦ÙŠØ§Øª:', error);
            }
        }

        function updateBusRecordsList() {
            try {
                const container = document.getElementById('busRecordsList');
                if (!container) {
                    console.error('Ù„Ù… ÙŠØªÙ… Ø§Ù„Ø¹Ø«ÙˆØ± Ø¹Ù„Ù‰ Ø­Ø§ÙˆÙŠØ© Ù‚Ø§Ø¦Ù…Ø© Ø§Ù„Ø­Ø§ÙÙ„Ø§Øª');
                    return;
                }

                const registeredBuses = (busRecords || []).filter(b => b && b.forms && Object.keys(b.forms).length > 0);

                if (registeredBuses.length === 0) {
                    container.innerHTML = '<div style="text-align: center; color: var(--text-muted); padding: 30px;">Ù„Ø§ ØªÙˆØ¬Ø¯ Ø­Ø§ÙÙ„Ø§Øª Ù…Ø³Ø¬Ù„Ø©</div>';
                    return;
                }

                container.innerHTML = registeredBuses.map(bus => {
                    try {
                        const completedForms = Object.keys(bus.forms || {}).length;
                        const progress = (completedForms / 5) * 100;
                        const formsList = ['ScrLogIn', 'ScrSegregationIn', 'ScrWelcomeLounge', 'ScrSegregationExit', 'ScrCurbside'];
                        const safePlate = (bus.BusPlate || '').replace(/'/g, "\\'");

                        return `
                            <div class="bus-record" onclick="openBusRecord('${safePlate}')">
                                <div class="bus-record-header">
                                    <span class="bus-record-plate">${bus.BusPlate || 'ØºÙŠØ± Ù…Ø­Ø¯Ø¯'}</span>
                                    <span class="bus-record-spot">${bus.spotNumber ? 'Ù…ÙˆÙ‚Ù ' + bus.spotNumber : 'ØºÙŠØ± Ù…Ø­Ø¯Ø¯'}</span>
                                </div>
                                <div class="bus-record-info">
                                    <span>âœˆï¸ ${bus.displayData?.flight || '-'}</span>
                                    <span>ğŸ‘¥ ${bus.displayData?.pax || 0}</span>
                                </div>
                                <div class="form-progress">
                                    <div class="form-progress-fill" style="width: ${progress}%;"></div>
                                </div>
                                <div class="bus-record-forms">
                                    ${formsList.map(f => `<span class="form-badge ${bus.forms && bus.forms[f] ? 'completed' : ''}">${f.replace('Scr','')}</span>`).join('')}
                                </div>
                            </div>
                        `;
                    } catch (busError) {
                        console.warn('Ø®Ø·Ø£ ÙÙŠ Ø¹Ø±Ø¶ Ø³Ø¬Ù„ Ø­Ø§ÙÙ„Ø©:', busError);
                        return '';
                    }
                }).join('');
            } catch (error) {
                console.error('Ø®Ø·Ø£ ÙÙŠ ØªØ­Ø¯ÙŠØ« Ù‚Ø§Ø¦Ù…Ø© Ø§Ù„Ø­Ø§ÙÙ„Ø§Øª:', error);
            }
        }

        function openBusRecord(plate) {
            const bus = busRecords.find(b => b.BusPlate === plate);
            if (bus) {
                currentBusPlate = plate;
                currentSpot = bus.spotNumber;
                // ÙØªØ­ Ø§Ù„Ù†Ù…ÙˆØ°Ø¬ Ø§Ù„ØªØ§Ù„ÙŠ ØºÙŠØ± Ø§Ù„Ù…ÙƒØªÙ…Ù„
                const formsList = ['ScrLogIn', 'ScrSegregationIn', 'ScrWelcomeLounge', 'ScrSegregationExit', 'ScrCurbside'];
                const nextForm = formsList.find(f => !bus.forms[f]) || 'ScrWelcomeLounge';
                currentForm = nextForm;
                openFormModal(nextForm, bus);
            }
        }

        // â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
        // TIME & SHIFT
        // â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
        
        function updateTimeAndShift() {
            const now = new Date();
            const timeString = now.toLocaleTimeString('ar-SA', { hour12: false });
            const dateString = now.toLocaleDateString('ar-SA');
            const hour = now.getHours();
            
            let shift = 'A';
            if (hour >= 6 && hour < 14) shift = 'A';
            else if (hour >= 14 && hour < 22) shift = 'B';
            else shift = 'C';
            
            document.getElementById('currentTime').textContent = timeString;
            document.getElementById('currentDate').textContent = dateString;
            document.getElementById('currentShift').textContent = shift;
            document.getElementById('lastUpdate').textContent = timeString;
        }

        // â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
        // TABS & UI
        // â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
        
        function switchTab(tabName) {
            document.querySelectorAll('.sidebar-tab').forEach(t => t.classList.remove('active'));
            document.querySelectorAll('.tab-panel').forEach(p => p.classList.remove('active'));
            
            event.target.closest('.sidebar-tab').classList.add('active');
            document.getElementById(tabName + 'Tab').classList.add('active');
        }

        function toggleSidebar() {
            const sidebar = document.getElementById('sidebar');
            const btn = document.getElementById('sidebarToggle');
            sidebar.classList.toggle('hidden');
            btn.classList.toggle('active');
        }

        function toggleEditMode() {
            editMode = !editMode;
            const btn = document.getElementById('editToggle');
            btn.classList.toggle('active', editMode);
            showNotification(editMode ? 'info' : 'warning', 'ÙˆØ¶Ø¹ Ø§Ù„ØªØ­Ø±ÙŠØ±', editMode ? 'ØªÙ… ØªÙØ¹ÙŠÙ„ ÙˆØ¶Ø¹ Ø§Ù„ØªØ­Ø±ÙŠØ±' : 'ØªÙ… Ø¥Ù„ØºØ§Ø¡ ÙˆØ¶Ø¹ Ø§Ù„ØªØ­Ø±ÙŠØ±');
        }

        function toggleSetting(setting) {
            settings[setting] = !settings[setting];
            const toggle = document.getElementById(setting + 'Toggle');
            toggle.classList.toggle('active', settings[setting]);
        }

        function updateColors() {
            // ÙŠÙ…ÙƒÙ† ØªÙˆØ³ÙŠØ¹ Ù‡Ø°Ù‡ Ø§Ù„ÙˆØ¸ÙŠÙØ© Ù„ØªØ­Ø¯ÙŠØ« Ø§Ù„Ø£Ù„ÙˆØ§Ù†
            showNotification('info', 'ØªØ­Ø¯ÙŠØ« Ø§Ù„Ø£Ù„ÙˆØ§Ù†', 'Ø³ÙŠØªÙ… ØªØ·Ø¨ÙŠÙ‚ Ø§Ù„Ø£Ù„ÙˆØ§Ù† Ø§Ù„Ø¬Ø¯ÙŠØ¯Ø©');
        }

        // â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
        // NOTIFICATIONS & ALERTS
        // â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
        
        function showNotification(type, title, message) {
            if (!settings.popup) return;
            
            const container = document.getElementById('notificationsContainer');
            const icons = { success: 'âœ…', warning: 'âš ï¸', error: 'âŒ', info: 'â„¹ï¸' };
            
            const notification = document.createElement('div');
            notification.className = `notification ${type}`;
            notification.innerHTML = `
                <span class="notification-icon">${icons[type]}</span>
                <div class="notification-content">
                    <div class="notification-title">${title}</div>
                    <div class="notification-message">${message}</div>
                </div>
                <span class="notification-close" onclick="this.parentElement.remove()">Ã—</span>
            `;
            
            container.appendChild(notification);
            setTimeout(() => notification.remove(), 5000);
        }

        function addAlert(type, title, message) {
            const now = new Date();
            alerts.unshift({
                type: type === 'success' ? 'success' : type === 'warning' ? 'warning' : type === 'error' ? 'danger' : 'info',
                title: title,
                message: message,
                time: now.toLocaleTimeString('ar-SA', { hour12: false })
            });
            
            if (alerts.length > 100) alerts.pop();
            updateAlertsList();
        }

        function updateAlertsList() {
            const container = document.getElementById('alertsList');
            const icons = { danger: 'ğŸ”´', warning: 'ğŸŸ ', info: 'ğŸ”µ', success: 'ğŸŸ¢' };
            
            if (alerts.length === 0) {
                container.innerHTML = '<div style="text-align: center; color: var(--text-muted); padding: 30px;">Ù„Ø§ ØªÙˆØ¬Ø¯ ØªÙ†Ø¨ÙŠÙ‡Ø§Øª</div>';
                return;
            }
            
            container.innerHTML = alerts.map(alert => `
                <div class="alert-item alert-${alert.type}">
                    <span class="alert-icon">${icons[alert.type]}</span>
                    <div class="alert-content">
                        <div class="alert-title">${alert.title}</div>
                        <div class="alert-message">${alert.message}</div>
                        <div class="alert-time">${alert.time}</div>
                    </div>
                </div>
            `).join('');
        }

        function clearAlerts() {
            alerts = [];
            updateAlertsList();
        }

        // â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
        // TOOLTIP
        // â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
        
        function showTooltip(event, data, statusInfo) {
            const tooltip = document.getElementById('tooltip');
            tooltip.style.display = 'block';
            
            tooltip.innerHTML = `
                <div class="tooltip-title">ğŸšŒ ØªÙØ§ØµÙŠÙ„ Ø§Ù„Ø­Ø§ÙÙ„Ø©</div>
                <div class="tooltip-line"><strong>Ø±Ù‚Ù… Ø§Ù„Ù„ÙˆØ­Ø©:</strong> ${data.plate}</div>
                <div class="tooltip-line"><strong>Ø±Ù‚Ù… Ø§Ù„Ø±Ø­Ù„Ø©:</strong> ${data.flight}</div>
                <div class="tooltip-line"><strong>Ø¹Ø¯Ø¯ Ø§Ù„Ø±ÙƒØ§Ø¨:</strong> ${data.pax}</div>
                <div class="tooltip-line"><strong>Ø§Ù„Ø¨ÙˆØ§Ø¨Ø©:</strong> ${data.gate}</div>
                <div class="tooltip-line"><strong>ÙˆÙ‚Øª Ø§Ù„ÙˆØµÙˆÙ„:</strong> ${data.arrival}</div>
                <div class="tooltip-line"><strong>ÙˆÙ‚Øª Ø§Ù„Ø¥Ù‚Ù„Ø§Ø¹:</strong> ${data.departure}</div>
                <div class="tooltip-line"><strong>Ø§Ù„ÙˆÙ‚Øª Ø§Ù„Ù…ØªØ¨Ù‚ÙŠ:</strong> ${statusInfo.hours.toFixed(2)} Ø³Ø§Ø¹Ø©</div>
                <div class="tooltip-line" style="color: ${statusInfo.status === 'early' ? '#4caf50' : statusInfo.status === 'late' ? '#f44336' : '#2196f3'}">
                    <strong>Ø§Ù„Ø­Ø§Ù„Ø©:</strong> ${statusInfo.label}
                </div>
            `;
            
            moveTooltip(event);
        }

        function moveTooltip(event) {
            const tooltip = document.getElementById('tooltip');
            tooltip.style.left = (event.pageX + 15) + 'px';
            tooltip.style.top = (event.pageY + 15) + 'px';
        }

        function hideTooltip() {
            document.getElementById('tooltip').style.display = 'none';
        }

        // â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
        // EXPORT - Ù…ØªÙˆØ§ÙÙ‚ Ù…Ø¹ Power BI
        // â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
        
        function exportToJSON() {
            try {
                if (!busRecords || busRecords.length === 0) {
                    showNotification('warning', 'ØªÙ†Ø¨ÙŠÙ‡', 'Ù„Ø§ ØªÙˆØ¬Ø¯ Ø¨ÙŠØ§Ù†Ø§Øª Ù„Ù„ØªØµØ¯ÙŠØ±');
                    return;
                }

                const data = {
                    exportDate: new Date().toISOString(),
                    busRecords: busRecords,
                    dailyStats: {
                        buses: dailyStats.buses,
                        passengers: dailyStats.passengers,
                        flights: Array.from(dailyStats.flights)
                    }
                };

                const jsonString = JSON.stringify(data, null, 2);
                if (!jsonString) {
                    throw new Error('ÙØ´Ù„ ÙÙŠ ØªØ­ÙˆÙŠÙ„ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª Ø¥Ù„Ù‰ JSON');
                }

                downloadFile(jsonString, 'locc_data.json', 'application/json');
                showNotification('success', 'ØªØµØ¯ÙŠØ±', 'ØªÙ… ØªØµØ¯ÙŠØ± Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª Ø¨ØµÙŠØºØ© JSON');
            } catch (error) {
                console.error('Ø®Ø·Ø£ ÙÙŠ ØªØµØ¯ÙŠØ± JSON:', error);
                showNotification('error', 'Ø®Ø·Ø£ ÙÙŠ Ø§Ù„ØªØµØ¯ÙŠØ±', 'ÙØ´Ù„ ÙÙŠ ØªØµØ¯ÙŠØ± Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª: ' + error.message);
            }
        }

        function exportToCSV() {
            try {
                if (!busRecords || busRecords.length === 0) {
                    showNotification('warning', 'ØªÙ†Ø¨ÙŠÙ‡', 'Ù„Ø§ ØªÙˆØ¬Ø¯ Ø¨ÙŠØ§Ù†Ø§Øª Ù„Ù„ØªØµØ¯ÙŠØ±');
                    return;
                }

                const busesWithData = busRecords.filter(bus => bus && bus.displayData);
                if (busesWithData.length === 0) {
                    showNotification('warning', 'ØªÙ†Ø¨ÙŠÙ‡', 'Ù„Ø§ ØªÙˆØ¬Ø¯ Ø­Ø§ÙÙ„Ø§Øª Ù…Ø¹ Ø¨ÙŠØ§Ù†Ø§Øª Ø¹Ø±Ø¶ Ù„Ù„ØªØµØ¯ÙŠØ±');
                    return;
                }

                let csv = 'BusPlate,SpotNumber,FlightNO,PaxAdlt,GateNO,ArrTime,DepTime,Status,FormsCompleted\n';
                busesWithData.forEach(bus => {
                    try {
                        const status = calculateStatus(bus.displayData.arrival, bus.displayData.departure).status;
                        const plate = (bus.BusPlate || '').replace(/,/g, ';');
                        const flight = (bus.displayData.flight || '').replace(/,/g, ';');
                        const gate = (bus.displayData.gate || '').replace(/,/g, ';');
                        csv += `${plate},${bus.spotNumber || ''},${flight},${bus.displayData.pax || 0},${gate},${bus.displayData.arrival || ''},${bus.displayData.departure || ''},${status},${Object.keys(bus.forms || {}).length}\n`;
                    } catch (rowError) {
                        console.warn('ØªØ®Ø·ÙŠ ØµÙ Ø¨Ø³Ø¨Ø¨ Ø®Ø·Ø£:', rowError, bus);
                    }
                });

                downloadFile(csv, 'locc_data.csv', 'text/csv');
                showNotification('success', 'ØªØµØ¯ÙŠØ±', 'ØªÙ… ØªØµØ¯ÙŠØ± Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª Ø¨ØµÙŠØºØ© CSV');
            } catch (error) {
                console.error('Ø®Ø·Ø£ ÙÙŠ ØªØµØ¯ÙŠØ± CSV:', error);
                showNotification('error', 'Ø®Ø·Ø£ ÙÙŠ Ø§Ù„ØªØµØ¯ÙŠØ±', 'ÙØ´Ù„ ÙÙŠ ØªØµØ¯ÙŠØ± Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª: ' + error.message);
            }
        }

        function downloadFile(content, filename, type) {
            let url = null;
            try {
                if (!content) {
                    throw new Error('Ù„Ø§ ÙŠÙˆØ¬Ø¯ Ù…Ø­ØªÙˆÙ‰ Ù„Ù„ØªÙ†Ø²ÙŠÙ„');
                }
                if (!filename) {
                    throw new Error('Ø§Ø³Ù… Ø§Ù„Ù…Ù„Ù Ù…Ø·Ù„ÙˆØ¨');
                }

                const blob = new Blob([content], { type: type || 'text/plain' });
                url = URL.createObjectURL(blob);

                if (!url) {
                    throw new Error('ÙØ´Ù„ ÙÙŠ Ø¥Ù†Ø´Ø§Ø¡ Ø±Ø§Ø¨Ø· Ø§Ù„ØªÙ†Ø²ÙŠÙ„');
                }

                const a = document.createElement('a');
                a.href = url;
                a.download = filename;
                document.body.appendChild(a);
                a.click();
                document.body.removeChild(a);
            } catch (error) {
                console.error('Ø®Ø·Ø£ ÙÙŠ ØªÙ†Ø²ÙŠÙ„ Ø§Ù„Ù…Ù„Ù:', error);
                showNotification('error', 'Ø®Ø·Ø£ ÙÙŠ Ø§Ù„ØªÙ†Ø²ÙŠÙ„', 'ÙØ´Ù„ ÙÙŠ ØªÙ†Ø²ÙŠÙ„ Ø§Ù„Ù…Ù„Ù: ' + error.message);
            } finally {
                if (url) {
                    URL.revokeObjectURL(url);
                }
            }
        }
    </script>
</body>
</html>
